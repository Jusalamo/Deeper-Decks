<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Deeper-Decks‚Ñ¢: The Card Game</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 fill=%22url(%23rainbow)%22>D</text><defs><linearGradient id=%22rainbow%22 gradientTransform=%22rotate(90)%22><stop offset=%220%25%22 stop-color=%22%23FF1F40%22/><stop offset=%2225%25%22 stop-color=%22%23FF8BA4%22/><stop offset=%2250%25%22 stop-color=%22%2348BB78%22/><stop offset=%2275%25%22 stop-color=%22%236F38E0%22/><stop offset=%22100%25%22 stop-color=%22%23FF1F40%22/></linearGradient></defs></svg>" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Mona Sans for all display/title text -->
    <link href="https://fonts.cdnfonts.com/css/mona-sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
   <style>
        /* ‚îÄ‚îÄ RESET & BASE FIXES ‚îÄ‚îÄ */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            font-synthesis: none;
            box-sizing: border-box;
        }

        html {
            overflow-x: hidden;
            /* Prevent horizontal scroll on mobile */
            overscroll-behavior-x: none;
        }

        body {
            overflow-x: hidden;
            max-width: 100%;
            margin: 0;
            padding: 0;
            /* Prevent horizontal scroll on mobile caused by swipe */
            overscroll-behavior-x: none;
            touch-action: pan-y; /* allow vertical scroll, block horizontal */
        }

        :root {
            --color-romantic: #FF1F40;
            --color-platonic: #48BB78;
            --color-naughty: #6F38E0;
            --color-girls: #FF8BA4;
            --bg-light: #FAFAFA;
            --surface-light: #F0F0F0;
            --modal-dark: #2A2A2A;
            --card-white: #FFFFFF;
            --text-dark: #1A1A1A;
            --text-light: #FFFFFF;
            --shadow-subtle: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
            --shadow-card: 0 20px 50px rgba(0,0,0,0.1);
            --shadow-stack: 0 10px 30px rgba(0,0,0,0.15), 0 4px 10px rgba(0,0,0,0.1);
        }

        body {
            background-color: var(--bg-light);
            font-family: 'Inter', sans-serif;
            color: var(--text-dark);
            height: 100vh;
            width: 100vw;
            position: fixed;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* MAIN GAME - SCROLLABLE */
        #mainGame {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in;
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            /* Extra bottom padding to prevent clipping */
            padding: 0.5rem 0.5rem 80px 0.5rem;
            position: relative;
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           TYPOGRAPHY SYSTEM
           ALL TITLES/HEADERS use Mona Sans with proper weight
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        /* Default body text */
        body, button, input, select, textarea, p, span, div {
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }

        /* ‚îÄ‚îÄ MONA SANS for all display/title elements ‚îÄ‚îÄ */
        .game-title,
        .sidebar-title,
        #deckTitle,
        .deck-option h3,
        .modal-content h2,
        .modal-content h3,
        .pause-big-title,
        .session-box-code,
        .card-back-title,
        .rainbow-logo,
        .card-header-chip,
        .player-badge,
        .btn-action,
        .btn-wildcard,
        .btn-history-sm,
        .btn-got-it,
        .timer-num,
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Mona Sans', 'Inter', sans-serif !important;
            font-weight: 900 !important;
            letter-spacing: -0.03em;
        }

        /* Ensure card question text is thick and uses Mona Sans */
        .card-question-text {
            font-family: 'Mona Sans', 'Inter', sans-serif !important;
            font-weight: 800 !important;
            font-size: clamp(1.3rem, 5vw, 1.8rem);
            line-height: 1.35;
            letter-spacing: -0.02em;
        }

        /* Stat values */
        .stat-mini-val {
            font-family: 'Mona Sans', 'Inter', sans-serif !important;
            font-weight: 900 !important;
            letter-spacing: -0.03em;
        }

        /* History item meta, heat label, shame label, vote label */
        .heat-label,
        .stat-mini-label,
        .shame-label,
        .vote-label,
        .consec-sub,
        .history-item-meta,
        .filter-btn {
            font-weight: 700 !important;
        }

        /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
        .sidebar-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:3000; opacity:0; visibility:hidden; transition:opacity 0.3s ease,visibility 0.3s ease; backdrop-filter:blur(4px); }
        .sidebar-overlay.active { opacity:1; visibility:visible; }
        .sidebar-menu { position:fixed; top:0; right:-100%; width:320px; height:100%; background:var(--modal-dark); z-index:3001; transition:right 0.4s cubic-bezier(0.4,0,0.2,1); padding:24px; overflow-y:auto; box-shadow:-5px 0 30px rgba(0,0,0,0.3); }
        .sidebar-menu.active { right:0; }
        .sidebar-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:32px; padding-bottom:16px; border-bottom:1px solid rgba(255,255,255,0.1); }
        .sidebar-title { font-size:1.5rem; color:var(--text-light); font-family:'Mona Sans',sans-serif !important; font-weight:900 !important; }
        .close-sidebar { background:none; border:none; color:var(--text-light); font-size:1.5rem; cursor:pointer; padding:8px; border-radius:8px; transition:background-color 0.2s; }
        .close-sidebar:hover { background-color:rgba(255,255,255,0.1); }
        .sidebar-item { display:flex; align-items:center; gap:12px; padding:14px 16px; background:rgba(255,255,255,0.05); border-radius:12px; margin-bottom:10px; cursor:pointer; transition:all 0.2s ease; color:var(--text-light); border:none; width:100%; text-align:left; font-size:1rem; font-weight:600; font-family:'Inter',sans-serif; }
        .sidebar-item:hover { background:rgba(255,255,255,0.1); transform:translateX(-2px); }
        .sidebar-divider { border:none; border-top:1px solid rgba(255,255,255,0.08); margin:8px 0 18px; }

        /* ‚îÄ‚îÄ HAMBURGER ‚îÄ‚îÄ */
        .hamburger-menu { position:fixed; top:20px; right:20px; z-index:2000; background:var(--modal-dark); border:none; border-radius:12px; width:48px; height:48px; display:none; flex-direction:column; justify-content:center; align-items:center; gap:6px; cursor:pointer; transition:all 0.2s ease; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
        .hamburger-menu:hover { transform:scale(1.05); }
        .hamburger-line { width:20px; height:2px; background:var(--text-light); border-radius:2px; transition:all 0.3s ease; }
        .hamburger-menu.active .hamburger-line:nth-child(1){transform:rotate(45deg) translate(6px,6px);}
        .hamburger-menu.active .hamburger-line:nth-child(2){opacity:0;}
        .hamburger-menu.active .hamburger-line:nth-child(3){transform:rotate(-45deg) translate(6px,-6px);}

        /* ‚îÄ‚îÄ INTRO ‚îÄ‚îÄ */
        #introScreen { position:fixed; top:0; left:0; width:100%; height:100%; background:#000; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:4000; transition:opacity 0.6s ease-out; }
        
        /* FIXED: Rainbow logo now uses Mona Sans with proper 900 weight */
        .rainbow-logo { 
            font-family:'Mona Sans',sans-serif !important; 
            font-size:3.5rem; 
            font-weight:900 !important; 
            background:linear-gradient(to right,#fff,#fff,#0ff,#00f,#800080,#ffb6c1,#f00,#ff0,#90ee90,#fff,#fff) no-repeat 100% 0% / 900%; 
            -webkit-background-clip:text; 
            -webkit-text-fill-color:transparent; 
            background-clip:text; 
            letter-spacing:-2px; 
            margin-bottom:1rem; 
            animation:rainbowSlide 2s ease-in-out forwards; 
        }
        @keyframes rainbowSlide{from{background-position:100% 0%}to{background-position:0% 0%}}
        .intro-subtitle { font-size:1.125rem; color:rgba(255,255,255,0.7); font-weight:400; letter-spacing:0.5px; margin-bottom:3rem; opacity:0; animation:fadeInUp 0.8s ease-out 0.8s forwards; }
        .rainbow-progress { width:200px; height:4px; background:rgba(255,255,255,0.2); border-radius:3px; overflow:hidden; opacity:0; animation:fadeIn 0.4s ease-out 0.5s forwards; }
        .rainbow-progress-bar { width:0%; height:100%; background:linear-gradient(to right,#0ff,#00f,#800080,#ffb6c1,#f00,#ff0,#90ee90); border-radius:3px; transition:width 1.8s cubic-bezier(0.28,0.11,0.32,1); }
        @keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}

        /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
        .card-stack-container { 
            aspect-ratio: 9/14; 
            width: min(380px, 90vw);
            max-width: 380px;
            min-width: 280px;
            position: relative;
            margin: 0 auto;
        }

        .card-front { 
            background-color: var(--card-white); 
            color: var(--text-dark); 
            border-radius: 24px; 
            box-shadow: 0 8px 24px rgba(0,0,0,0.12); 
            transition: transform 0.4s cubic-bezier(0.175,0.885,0.32,1.275), opacity 0.3s ease; 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            top: 0; 
            left: 0; 
            will-change: transform, opacity; 
            border: 1px solid rgba(0,0,0,0.08); 
            cursor: pointer; 
            user-select: none; 
            -webkit-user-select: none;
            display: flex;
            flex-direction: column;
            padding: 1.8rem;
        }

        /* FIXED: Card back title uses Mona Sans 900 */
        .card-back { 
            background: linear-gradient(135deg,#2A2A2A 0%,#1F1F1F 100%); 
            border-radius: 20px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            position: absolute; 
            width: 98%; 
            height: 98%; 
            top: 1%; 
            left: 1%; 
            z-index: -1; 
            border:1px solid rgba(255,255,255,0.05); 
        }
        .card-back-title {
            font-family: 'Mona Sans', sans-serif !important;
            font-weight: 900 !important;
            font-size: 1rem;
            letter-spacing: -0.02em;
            color: rgba(255,255,255,0.8);
        }

        .card-slide-out-left  { transform:translateX(-150%) rotate(-15deg) !important; opacity:0 !important; }
        .card-slide-out-right { transform:translateX(150%)  rotate(15deg)  !important; opacity:0 !important; }
        .empty-card { border:3px dashed var(--text-dark); background-color:var(--card-white); }

        .card-content-area { 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            overflow: hidden;
            min-height: 0;
        }

        .card-header-chip { 
            border-radius: 9999px; 
            padding: 8px 16px; 
            font-size: 0.85rem; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-family: 'Mona Sans', sans-serif !important;
            font-weight: 900 !important;
            letter-spacing: -0.01em;
        }

        .player-badge { 
            display: inline-flex; 
            align-items: center; 
            gap: 8px; 
            padding: 10px 20px; 
            border-radius: 999px; 
            font-size: 0.95rem; 
            color: white; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-family: 'Mona Sans', sans-serif !important;
            font-weight: 900 !important;
        }

        /* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
        .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center; z-index:2000; backdrop-filter:blur(4px); }
        .modal-content { background:var(--modal-dark); border:1px solid rgba(255,255,255,0.1); border-radius:24px; padding:32px; max-width:500px; width:90%; max-height:85vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,0.3); color:var(--text-light); }
        .deck-modal-content { max-width:600px; }
        .deck-option { background:rgba(255,255,255,0.05); border:2px solid transparent; border-radius:16px; padding:20px; margin-bottom:15px; cursor:pointer; transition:all 0.3s ease; }
        .deck-option:hover { background:rgba(255,255,255,0.1); transform:translateY(-2px); }
        .deck-option.active { border-color:currentColor; background:rgba(255,255,255,0.15); }
        .deck-option h3 { font-family:'Mona Sans',sans-serif !important; font-weight:900 !important; font-size:1.2rem !important; letter-spacing:-0.03em; }
        .player-input { background:rgba(0,0,0,0.3); border:2px solid rgba(255,255,255,0.2); border-radius:12px; padding:12px 16px; color:var(--text-light); font-size:1rem; transition:border-color 0.2s; font-family:'Inter',sans-serif; }
        .player-input:focus { outline:none; border-color:rgba(255,255,255,0.4); }
        .player-item { background:rgba(0,0,0,0.2); border:1px solid rgba(255,255,255,0.1); border-radius:12px; padding:12px 16px; display:flex; justify-content:space-between; align-items:center; color:var(--text-light); margin-bottom:8px; cursor:grab; transition:all 0.2s; }
        .player-item:active { cursor:grabbing; }
        .player-item.drag-over { border-color:rgba(255,255,255,0.5)!important; background:rgba(255,255,255,0.12)!important; }
        .player-item.current-turn { border-color:rgba(72,187,120,0.5); background:rgba(72,187,120,0.08); }
        .btn-remove { background:rgba(255,107,129,0.2); color:var(--color-romantic); border-radius:8px; padding:6px 12px; font-size:0.875rem; transition:all 0.2s; border:none; cursor:pointer; }

        /* ‚îÄ‚îÄ CONTROL PANEL ‚îÄ‚îÄ */
        .control-panel { 
            background: var(--surface-light); 
            border: 1px solid rgba(0,0,0,0.1); 
            border-radius: 20px; 
            padding: 1rem;
            box-shadow: var(--shadow-subtle); 
            color: var(--text-dark);
            width: 100%;
            max-width: 380px;
            /* FIXED: proper bottom margin */
            margin: 0 auto 24px auto;
        }

        .btn-action { 
            background-color: var(--modal-dark); 
            color: var(--text-light); 
            border-radius: 14px; 
            padding: 12px 20px; 
            transition: background 0.2s ease,transform 0.1s ease,box-shadow 0.2s; 
            box-shadow: 0 3px 0 rgba(0,0,0,0.2); 
            border: none; 
            cursor: pointer; 
            font-family: 'Mona Sans', sans-serif !important;
            font-weight: 900 !important;
            font-size: 0.9rem;
            letter-spacing: -0.01em;
            width: 100%;
        }
        .btn-action:hover:not(:disabled) { background-color:#3A3A3A; transform:translateY(-2px); box-shadow:0 5px 0 rgba(0,0,0,0.2); }
        .btn-action:disabled { opacity:0.4; cursor:not-allowed; transform:translateY(0); box-shadow:0 3px 0 rgba(0,0,0,0.1); }
        .btn-shuffle { background-color:var(--surface-light); color:var(--text-dark); border:1px solid rgba(0,0,0,0.1); box-shadow:0 3px 0 rgba(0,0,0,0.05); margin-top:0.4rem; }
        .btn-shuffle:hover:not(:disabled) { background-color:#E0E0E0; }
        .counter-box { background-color:var(--surface-light); border:1px solid rgba(0,0,0,0.08); box-shadow:var(--shadow-subtle); }
        .settings-option { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.1); color:var(--text-light); }
        .shuffling { animation:shuffleAnim 0.5s ease-in-out; }
        @keyframes shuffleAnim{0%{transform:rotate(0) scale(1)}25%{transform:rotate(-5deg) scale(1.02)}50%{transform:rotate(5deg) scale(1.02)}75%{transform:rotate(-2deg) scale(1.01)}100%{transform:rotate(0) scale(1)}}
        .swipe-instruction { text-align:center; margin-top:10px; color:rgba(0,0,0,0.5); font-size:0.75rem; font-weight:500; }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           REDESIGNED: DECK/FILTER DROPDOWN
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .deck-dropdown-wrap {
            position: relative;
            margin-bottom: 0.5rem;
        }
        .deck-dropdown-btn {
            width: 100%;
            background: #fff;
            border: 1.5px solid rgba(0,0,0,0.1);
            border-radius: 12px;
            padding: 10px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-family: 'Mona Sans', sans-serif;
            font-weight: 700;
            font-size: 0.85rem;
            color: var(--text-dark);
            transition: all 0.2s;
            box-shadow: 0 1px 4px rgba(0,0,0,0.07);
        }
        .deck-dropdown-btn:hover { border-color: rgba(0,0,0,0.2); background: #f8f8f8; }
        .deck-dropdown-btn .dd-arrow {
            font-size: 0.7rem;
            opacity: 0.5;
            transition: transform 0.2s;
        }
        .deck-dropdown-btn.open .dd-arrow { transform: rotate(180deg); }
        .deck-dropdown-menu {
            position: absolute;
            top: calc(100% + 6px);
            left: 0;
            right: 0;
            background: #fff;
            border: 1.5px solid rgba(0,0,0,0.1);
            border-radius: 14px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            z-index: 100;
            overflow: hidden;
            display: none;
            animation: dropdownFade 0.18s ease;
        }
        .deck-dropdown-menu.open { display: block; }
        @keyframes dropdownFade {
            from { opacity:0; transform:translateY(-6px); }
            to   { opacity:1; transform:translateY(0); }
        }
        .dd-option {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 11px 14px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-dark);
            transition: background 0.15s;
            text-align: left;
        }
        .dd-option:not(:last-child) { border-bottom: 1px solid rgba(0,0,0,0.06); }
        .dd-option:hover { background: rgba(0,0,0,0.04); }
        .dd-option.active { color: #fff; }
        .dd-option .dd-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .dd-option-label { flex: 1; }
        .dd-option .dd-check { font-size: 0.75rem; opacity: 0; transition: opacity 0.15s; }
        .dd-option.active .dd-check { opacity: 1; }

        /* ‚îÄ‚îÄ DARK MODE ‚îÄ‚îÄ */
        body.dark-mode { background-color:#121212; color:#FFFFFF!important; }
        body.dark-mode .text-gray-900,body.dark-mode .text-gray-800,body.dark-mode .text-gray-700{color:#FFFFFF!important;}
        body.dark-mode .text-gray-600,body.dark-mode .text-gray-500,body.dark-mode .text-gray-400{color:#A0A0A0!important;}
        body.dark-mode .control-panel,.dark-mode .counter-box{background-color:#1F1F1F;color:#FFFFFF;border-color:rgba(255,255,255,0.1);}
        body.dark-mode .card-front{background-color:#2A2A2A;color:#FFFFFF;border-color:rgba(255,255,255,0.1);}
        body.dark-mode .card-question-text{color:#FFFFFF;}
        body.dark-mode .swipe-instruction{color:rgba(255,255,255,0.5);}
        body.dark-mode .btn-shuffle{background-color:#2A2A2A;color:#FFFFFF;border-color:rgba(255,255,255,0.1);}
        body.dark-mode .btn-shuffle:hover:not(:disabled){background-color:#3A3A3A;}
        body.dark-mode .empty-card{border-color:#FFFFFF;background-color:#2A2A2A;}
        body.dark-mode .heat-label{color:rgba(255,255,255,0.4);}
        body.dark-mode .heat-bar-outer{background:rgba(255,255,255,0.1);}
        body.dark-mode .stat-mini-label{color:rgba(255,255,255,0.5);}
        body.dark-mode .stat-mini{border-color:rgba(255,255,255,0.06);}
        body.dark-mode .timer-bar-outer{background:rgba(255,255,255,0.1);}
        body.dark-mode .timer-num{color:#fff;}
        body.dark-mode #dareVote{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.1);}
        body.dark-mode .vote-label{color:rgba(255,255,255,0.5);}
        body.dark-mode .vote-btn{background:rgba(255,255,255,0.07);border-color:rgba(255,255,255,0.12);color:#fff;}
        body.dark-mode .pass-player-name{color:#fff;}
        body.dark-mode .pass-player-sub{color:rgba(255,255,255,0.5);}
        body.dark-mode .btn-history-sm{background:#2A2A2A;color:#fff;border-color:rgba(255,255,255,0.1);}
        body.dark-mode .btn-history-sm:hover{background:#3A3A3A;}
        body.dark-mode .deck-dropdown-btn { background:#2A2A2A; color:#fff; border-color:rgba(255,255,255,0.1); }
        body.dark-mode .deck-dropdown-btn:hover { background:#333; }
        body.dark-mode .deck-dropdown-menu { background:#2A2A2A; border-color:rgba(255,255,255,0.1); }
        body.dark-mode .dd-option { color:#fff; }
        body.dark-mode .dd-option:not(:last-child) { border-bottom-color:rgba(255,255,255,0.06); }
        body.dark-mode .dd-option:hover { background:rgba(255,255,255,0.07); }

        /* ‚îÄ‚îÄ MOBILE LAYOUT FIXES ‚îÄ‚îÄ */
        @media(max-width:1024px){
            main {
                flex-direction: column-reverse;
                align-items: center;
            }
            .control-panel {
                width: 100%;
                max-width: 380px;
                margin-top: 1.5rem;
                /* FIXED: bottom margin on mobile too */
                margin-bottom: 32px;
            }
            header {
                margin-top: 0.5rem;
            }
            .sidebar-menu {
                width: 280px;
            }
        }

        @media(max-width:600px){
            .card-stack-container {
                width: min(350px, 90vw);
            }
            .card-front {
                padding: 1.2rem;
            }
            .card-question-text {
                font-size: 1.2rem;
            }
            .control-panel {
                padding: 0.8rem;
            }
            #mainGame {
                /* Extra padding on small screens */
                padding-bottom: 100px;
            }
        }

        /* FIXED: swipe zone only captures horizontal input, vertical scroll still works */
        .swipe-zone {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            touch-action: none; /* we handle all touch ourselves */
        }

        /* ‚ïê‚ïê‚ïê‚ïê NEW FEATURE STYLES ‚ïê‚ïê‚ïê‚ïê */
        /* PAUSE OVERLAY */
        #pauseOverlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.88);z-index:5000;display:none;flex-direction:column;justify-content:center;align-items:center;gap:2rem;backdrop-filter:blur(18px);}
        #pauseOverlay.active{display:flex;animation:fadeInUp 0.3s ease;}
        .pause-big-title{font-family:'Mona Sans',sans-serif !important;font-size:3rem;font-weight:900 !important;color:#fff;letter-spacing:-2px;}
        .pause-sub{color:rgba(255,255,255,0.5);font-size:1rem;margin-top:0.25rem;text-align:center;}
        .session-box{background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.12);border-radius:16px;padding:20px 32px;text-align:center;margin-top:0.5rem;}
        .session-box-label{font-size:0.72rem;text-transform:uppercase;letter-spacing:0.12em;color:rgba(255,255,255,0.4);margin-bottom:8px;}
        .session-box-code{font-family:'Mona Sans',sans-serif !important;font-size:2.5rem;font-weight:900 !important;letter-spacing:0.25em;color:#fff;}
        .session-box-hint{font-size:0.72rem;color:rgba(255,255,255,0.35);margin-top:6px;}
        .pause-btns{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;}

        /* PASS PHONE BANNER */
        #passBanner{display:none;background:linear-gradient(135deg,rgba(255,31,64,0.12),rgba(111,56,224,0.12));border:1px solid rgba(255,31,64,0.25);border-radius:14px;padding:14px 18px;margin-bottom:0.75rem;align-items:center;gap:12px;animation:fadeInUp 0.35s ease;}
        #passBanner.show{display:flex;}
        .pass-icon{font-size:1.6rem;animation:phoneBounce 1s ease infinite;}
        @keyframes phoneBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
        .pass-info{flex:1;}
        .pass-player-name{font-family:'Mona Sans',sans-serif !important;font-weight:900 !important;font-size:1.05rem;color:var(--text-dark);}
        .pass-player-sub{font-size:0.78rem;color:rgba(0,0,0,0.45);margin-top:2px;}
        .btn-got-it{background:var(--modal-dark);color:#fff;border:none;border-radius:10px;padding:9px 16px;font-family:'Mona Sans',sans-serif !important;font-weight:900 !important;cursor:pointer;font-size:0.88rem;transition:all 0.2s;}
        .btn-got-it:hover{background:#3A3A3A;}

        /* TIMER */
        #timerWrap{display:none;align-items:center;gap:10px;margin-bottom:0.75rem;}
        #timerWrap.show{display:flex;}
        .timer-bar-outer{flex:1;height:6px;background:rgba(0,0,0,0.09);border-radius:99px;overflow:hidden;}
        .timer-bar-inner{height:100%;border-radius:99px;width:100%;background:linear-gradient(90deg,#48BB78,#FFD60A,#FF1F40);transition:width 1s linear;}
        .timer-num{font-family:'Mona Sans',sans-serif !important;font-weight:900 !important;font-size:1.1rem;min-width:28px;text-align:right;color:var(--text-dark);}
        .timer-num.urgent{color:#FF1F40;animation:timerUrgent 0.5s ease infinite;}
        @keyframes timerUrgent{0%,100%{opacity:1}50%{opacity:0.4}}

        /* HEAT METER */
        .heat-row{display:flex;align-items:center;gap:8px;margin-bottom:4px;}
        .heat-label{font-size:0.73rem;color:rgba(0,0,0,0.4);white-space:nowrap;font-weight:700;}
        .heat-bar-outer{flex:1;height:5px;background:rgba(0,0,0,0.08);border-radius:99px;overflow:hidden;}
        .heat-bar-inner{height:100%;border-radius:99px;transition:width 0.8s ease,background 0.8s ease;}
        .heat-emoji{font-size:1rem;}
        #heatLevelLabel{font-size:0.68rem;text-align:right;margin-top:1px;transition:color 0.8s ease;}

        /* STAT MINIS */
        .stat-mini{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid rgba(0,0,0,0.06);font-size:0.78rem;}
        .stat-mini:last-child{border-bottom:none;}
        .stat-mini-label{color:rgba(0,0,0,0.45);font-weight:600;}
        .stat-mini-val{font-family:'Mona Sans',sans-serif !important;font-weight:900 !important;}
        .stat-skips{color:#FF1F40;}

        /* DARE VOTE */
        #dareVote{display:none;background:rgba(0,0,0,0.04);border:1px solid rgba(0,0,0,0.08);border-radius:12px;padding:12px;margin-top:0.75rem;}
        #dareVote.show{display:block;animation:fadeInUp 0.3s ease;}
        .vote-label{font-size:0.78rem;color:rgba(0,0,0,0.45);margin-bottom:8px;font-weight:700;}
        .vote-btns{display:flex;gap:6px;}
        .vote-btn{flex:1;padding:8px;border-radius:10px;border:1px solid rgba(0,0,0,0.1);background:#fff;font-size:0.8rem;cursor:pointer;transition:all 0.2s;font-family:'Inter',sans-serif;font-weight:700;}
        .vote-btn.yes:hover{background:rgba(72,187,120,0.13);border-color:#48BB78;color:#276749;}
        .vote-btn.no:hover{background:rgba(255,31,64,0.1);border-color:#FF1F40;color:#FF1F40;}
        .vote-tally{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px;font-size:0.73rem;}
        .tally-yes{color:#48BB78;background:rgba(72,187,120,0.1);border-radius:99px;padding:2px 10px;}
        .tally-no{color:#FF1F40;background:rgba(255,31,64,0.08);border-radius:99px;padding:2px 10px;}

        /* SHAME */
        .shame-label{font-size:0.7rem;color:#FF1F40;font-weight:700;text-align:center;margin-top:3px;display:none;}

        /* WILDCARD + HISTORY ROW */
        .btn-wildcard{background:linear-gradient(135deg,#6F38E0,#FF1F40);color:#fff;border:none;border-radius:12px;padding:10px 14px;font-family:'Mona Sans',sans-serif !important;font-weight:900 !important;font-size:0.82rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:6px;box-shadow:0 4px 10px rgba(111,56,224,0.25);}
        .btn-wildcard:hover{filter:brightness(1.1);transform:translateY(-1px);}
        .btn-history-sm{background:var(--surface-light);color:var(--text-dark);border:1px solid rgba(0,0,0,0.1);border-radius:12px;padding:10px 14px;font-family:'Mona Sans',sans-serif !important;font-weight:900 !important;font-size:0.82rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:6px;}
        .btn-history-sm:hover{background:#E0E0E0;}

        /* CONSEQUENCE TOAST */
        #consecToast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(130px);background:linear-gradient(135deg,#FF1F40,#FF9F0A);color:#fff;border-radius:16px;padding:1rem 1.5rem;font-size:1rem;z-index:6000;transition:transform 0.45s cubic-bezier(0.34,1.56,0.64,1);text-align:center;min-width:240px;box-shadow:0 10px 40px rgba(255,31,64,0.4);pointer-events:auto;cursor:pointer;touch-action:pan-x;}
        #consecToast.show{transform:translateX(-50%) translateY(0);}
        #consecToast .dismiss-hint{font-size:0.62rem;opacity:0.65;margin-top:5px;text-transform:uppercase;letter-spacing:0.08em;}
        .consec-sub{font-family:'Mona Sans',sans-serif !important;font-weight:900 !important;font-size:0.68rem;text-transform:uppercase;letter-spacing:0.1em;opacity:0.8;margin-bottom:4px;}

        /* HISTORY DRAWER */
        #historyBg{position:fixed;inset:0;z-index:4400;background:rgba(0,0,0,0.5);display:none;}
        #historyBg.show{display:block;}
        #historyDrawer{position:fixed;bottom:0;left:0;right:0;z-index:4500;background:var(--modal-dark);border-top:1px solid rgba(255,255,255,0.1);border-radius:24px 24px 0 0;padding:1.5rem;max-height:60vh;overflow-y:auto;transform:translateY(100%);transition:transform 0.4s cubic-bezier(0.4,0,0.2,1);}
        #historyDrawer.open{transform:translateY(0);}
        .drawer-handle{width:40px;height:4px;background:rgba(255,255,255,0.15);border-radius:99px;margin:0 auto 1.25rem;}
        .history-item{padding:11px;border-radius:10px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.07);margin-bottom:8px;font-size:0.82rem;color:rgba(255,255,255,0.72);transition:all 0.2s;}
        .history-item:hover{background:rgba(255,255,255,0.1);color:#fff;}
        .history-item-meta{font-family:'Mona Sans',sans-serif !important;font-weight:900 !important;font-size:0.67rem;text-transform:uppercase;letter-spacing:0.08em;margin-bottom:4px;opacity:0.7;}

        /* TOGGLE */
        .toggle{position:relative;width:40px;height:22px;flex-shrink:0;}
        .toggle input{opacity:0;width:0;height:0;}
        .toggle-slider{position:absolute;inset:0;cursor:pointer;background:rgba(255,255,255,0.15);border-radius:99px;transition:0.3s;}
        .toggle-slider:before{content:'';position:absolute;height:16px;width:16px;left:3px;bottom:3px;background:#fff;border-radius:50%;transition:0.3s;}
        input:checked + .toggle-slider{background:#48BB78;}
        input:checked + .toggle-slider:before{transform:translateX(18px);}

        /* CURRENT PLAYER DOT */
        .now-dot{width:8px;height:8px;border-radius:50%;background:#48BB78;display:inline-block;margin-right:4px;animation:nowPulse 1.5s ease infinite;}
        @keyframes nowPulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.35);opacity:0.6}}

        /* RESUME MODAL CODE INPUT */
        .resume-code-inp{font-family:'Mona Sans',sans-serif !important;font-weight:900 !important;font-size:1.5rem;letter-spacing:0.2em;text-align:center;text-transform:uppercase;width:100%;}
    </style>
</head>
<body>

<!-- CONSEQUENCE TOAST -->
<div id="consecToast">
    <div class="consec-sub">Skip Consequence üî•</div>
    <div id="consecText">Take a sip!</div>
    <div class="dismiss-hint">tap or swipe to dismiss</div>
</div>

<!-- PAUSE OVERLAY -->
<div id="pauseOverlay">
    <div style="text-align:center;">
        <div class="pause-big-title">‚è∏ Paused</div>
        <div class="pause-sub">Game is saved. Resume whenever you're ready.</div>
    </div>
    <div class="session-box">
        <div class="session-box-label">Session Code ‚Äî use to resume later</div>
        <div class="session-box-code" id="pauseCodeVal">‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî</div>
        <div class="session-box-hint">Enter this code in "Resume Game" to pick up exactly here</div>
    </div>
    <div class="pause-btns">
        <button class="btn-action" style="padding:14px 32px;font-size:1rem;" onclick="resumeGame()">‚ñ∂ Resume Game</button>
        <button class="btn-action" style="padding:14px 24px;font-size:1rem;background:rgba(255,255,255,0.1);" onclick="endGame()">End Game</button>
    </div>
</div>

<!-- HISTORY BACKDROP + DRAWER -->
<div id="historyBg" onclick="closeHistory()"></div>
<div id="historyDrawer">
    <div class="drawer-handle"></div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <h3 style="font-family:'Mona Sans',sans-serif;font-weight:900;color:#fff;font-size:1.2rem;letter-spacing:-0.03em;">Card History</h3>
        <button onclick="closeHistory()" style="background:rgba(255,255,255,0.1);border:none;color:#fff;border-radius:8px;width:32px;height:32px;cursor:pointer;font-size:1rem;">‚úï</button>
    </div>
    <div id="historyList"><p style="color:rgba(255,255,255,0.35);text-align:center;padding:2rem 0;font-size:0.85rem;">No cards drawn yet.</p></div>
</div>

<!-- HAMBURGER -->
<button id="hamburgerButton" class="hamburger-menu">
    <div class="hamburger-line"></div>
    <div class="hamburger-line"></div>
    <div class="hamburger-line"></div>
</button>

<!-- SIDEBAR -->
<div id="sidebarOverlay" class="sidebar-overlay"></div>
<div id="sidebarMenu" class="sidebar-menu">
    <div class="sidebar-header">
        <h3 class="sidebar-title">Menu</h3>
        <button id="closeSidebar" class="close-sidebar">‚úï</button>
    </div>
    <button id="sbPlayers"  class="sidebar-item">üë• Manage Players</button>
    <button id="sbDeck"     class="sidebar-item">üÉè Change Deck</button>
    <button id="sbHistory"  class="sidebar-item">üìñ Card History</button>
    <button id="sbResume"   class="sidebar-item">üîë Resume Saved Game</button>
    <hr class="sidebar-divider">
    <button id="sbPause"    class="sidebar-item">‚è∏ Pause Game</button>
    <button id="sbSettings" class="sidebar-item">‚öôÔ∏è Settings</button>
    <div style="margin-top:2rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,0.08);text-align:center;color:rgba(255,255,255,0.25);font-size:0.78rem;">
        <p style="font-family:'Mona Sans',sans-serif;font-weight:700;">Deeper-Decks‚Ñ¢ v2</p>
        <p style="margin-top:4px;">The Card Game for Real Connection</p>
    </div>
</div>

<!-- INTRO -->
<div id="introScreen">
    <header style="max-width:36rem;width:100%;text-align:center;margin-bottom:1.5rem;padding:0 1rem;">
        <h1 class="rainbow-logo">Deeper-Decks‚Ñ¢</h1>
        <div class="intro-subtitle">The Card Game for Real Connection</div>
    </header>
    <div class="rainbow-progress">
        <div class="rainbow-progress-bar" id="rainbowProgressBar"></div>
    </div>
</div>

<!-- PLAYER MODAL -->
<div id="playerModal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <h2 style="font-family:'Mona Sans',sans-serif;font-weight:900;font-size:1.8rem;color:#fff;text-align:center;letter-spacing:-0.04em;margin-bottom:0.5rem;">Deeper-Decks‚Ñ¢</h2>
        <p class="text-gray-400 text-center mb-6">Add players ¬∑ drag to reorder turn order</p>
        <div class="mb-6">
            <div class="flex gap-2 mb-4">
                <input type="text" id="playerNameInput" class="player-input flex-1" placeholder="Enter player name" maxlength="20">
                <button id="addPlayerBtn" class="btn-action px-6" style="width:auto;">Add</button>
            </div>
            <div id="playersList" class="mb-4"></div>
            <p class="text-sm text-gray-400 text-center mb-4"><span id="playerCount">0</span> players added (minimum 2)</p>
        </div>
        <button id="startGameBtn" class="btn-action w-full text-lg py-3" disabled>Choose Deck &amp; Start Playing</button>
    </div>
</div>

<!-- DECK MODAL -->
<div id="deckModal" class="modal-overlay" style="display:none;">
    <div class="modal-content deck-modal-content">
        <h2 style="font-family:'Mona Sans',sans-serif;font-weight:900;font-size:1.8rem;color:#fff;text-align:center;letter-spacing:-0.04em;margin-bottom:0.5rem;">Choose Your Deck</h2>
        <p class="text-gray-400 text-center mb-6">Cards escalate in heat as you play ‚Äî buckle up</p>
        <div id="deckOptions">
            <div class="deck-option" data-deck="romantic" style="color:var(--color-romantic);">
                <div style="display:flex;align-items:center;gap:12px;">
                    <span style="font-size:1.5rem;">‚ù§Ô∏è</span>
                    <div><h3>Romantic Deck</h3><p class="text-gray-400 text-sm">90 cards for couples &amp; dates ¬∑ starts warm, gets electric</p></div>
                </div>
            </div>
            <div class="deck-option" data-deck="platonic" style="color:var(--color-platonic);">
                <div style="display:flex;align-items:center;gap:12px;">
                    <span style="font-size:1.5rem;">ü§ù</span>
                    <div><h3>Platonic Deck</h3><p class="text-gray-400 text-sm">90 cards for friends &amp; hangouts ¬∑ chaotic guaranteed</p></div>
                </div>
            </div>
            <div class="deck-option" data-deck="girlsnight" style="color:var(--color-girls);">
                <div style="display:flex;align-items:center;gap:12px;">
                    <span style="font-size:1.5rem;">üíÖ</span>
                    <div><h3>Girls' Night Deck</h3><p class="text-gray-400 text-sm">90 cards for girls' nights ¬∑ no filter mode</p></div>
                </div>
            </div>
            <div class="deck-option" data-deck="naughty" style="color:var(--color-naughty);">
                <div style="display:flex;align-items:center;gap:12px;">
                    <span style="font-size:1.5rem;">üî•</span>
                    <div><h3>Naughty Deck</h3><p class="text-gray-400 text-sm">90 cards ¬∑ adults only ¬∑ no one leaves the same</p></div>
                </div>
            </div>
        </div>
        <button id="confirmDeckBtn" class="btn-action w-full text-lg py-3 mt-6" disabled>Start Playing with Selected Deck</button>
    </div>
</div>

<!-- SETTINGS MODAL -->
<div id="settingsModal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <h2 style="font-family:'Mona Sans',sans-serif;font-weight:900;font-size:1.8rem;color:#fff;text-align:center;letter-spacing:-0.04em;margin-bottom:1.5rem;">Settings</h2>
        <div>
            <div class="settings-option">
                <span>Theme</span>
                <select id="themeSelect" class="player-input">
                    <option value="light">Light Mode</option>
                    <option value="dark">Dark Mode</option>
                </select>
            </div>
            <div class="settings-option">
                <div><div style="font-weight:700;">Turn Timer</div><div style="font-size:0.73rem;opacity:0.55;margin-top:2px;">Countdown pressure per card</div></div>
                <label class="toggle"><input type="checkbox" id="timerToggle" onchange="onTimerToggle()"><span class="toggle-slider"></span></label>
            </div>
            <div class="settings-option" id="timerDurRow" style="display:none;">
                <div style="font-weight:700;">Timer Duration</div>
                <div style="display:flex;align-items:center;gap:8px;">
                    <input type="range" min="10" max="90" step="5" value="30" id="timerDuration" style="width:90px;accent-color:#48BB78;" oninput="document.getElementById('timerDurLbl').textContent=this.value+'s'">
                    <span id="timerDurLbl" style="font-weight:900;font-family:'Mona Sans',sans-serif;min-width:30px;">30s</span>
                </div>
            </div>
            <div class="settings-option">
                <div><div style="font-weight:700;">Sound Effects</div><div style="font-size:0.73rem;opacity:0.55;margin-top:2px;">Card draws, dare fanfares, timer alerts</div></div>
                <label class="toggle"><input type="checkbox" id="soundToggle" checked><span class="toggle-slider"></span></label>
            </div>
            <div class="settings-option">
                <div><div style="font-weight:700;">Pass Phone Mode</div><div style="font-size:0.73rem;opacity:0.55;margin-top:2px;">Shows whose turn it is before each draw</div></div>
                <label class="toggle"><input type="checkbox" id="passModeToggle" checked><span class="toggle-slider"></span></label>
            </div>
            <div class="settings-option">
                <div><div style="font-weight:700;">Dare Voting</div><div style="font-size:0.73rem;opacity:0.55;margin-top:2px;">Group votes whether the dare was actually done</div></div>
                <label class="toggle"><input type="checkbox" id="dareVoteToggle" checked><span class="toggle-slider"></span></label>
            </div>
            <div class="settings-option">
                <div><div style="font-weight:700;">Skip Consequences</div><div style="font-size:0.73rem;opacity:0.55;margin-top:2px;">Skipping a card triggers a punishment</div></div>
                <label class="toggle"><input type="checkbox" id="consequenceToggle" checked><span class="toggle-slider"></span></label>
            </div>
            <div class="settings-option">
                <span>Card Animation Speed</span>
                <select id="animationSpeed" class="player-input">
                    <option value="fast">Fast</option>
                    <option value="normal" selected>Normal</option>
                    <option value="slow">Slow</option>
                </select>
            </div>
            <div class="settings-option">
                <span>Swipe Sensitivity</span>
                <select id="swipeSensitivity" class="player-input">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                </select>
            </div>
        </div>
        <button id="closeSettingsBtn" class="btn-action w-full text-lg py-3 mt-6">Save &amp; Close</button>
    </div>
</div>

<!-- RESUME MODAL -->
<div id="resumeModal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <h2 style="font-family:'Mona Sans',sans-serif;font-weight:900;font-size:1.8rem;color:#fff;text-align:center;letter-spacing:-0.04em;margin-bottom:0.5rem;">Resume Game</h2>
        <p class="text-gray-400 text-center mb-6">Enter your 6-character session code to pick up exactly where you left off</p>
        <input type="text" id="resumeCodeInput" class="player-input resume-code-inp mb-3" maxlength="6" placeholder="ABC123">
        <div id="resumeErr" style="color:#FF1F40;font-size:0.8rem;text-align:center;min-height:1.2rem;margin-bottom:0.75rem;"></div>
        <button class="btn-action w-full text-lg py-3" onclick="tryResume()">Resume ‚Üí</button>
        <button class="btn-action w-full py-3 mt-3" style="background:rgba(255,255,255,0.08);" onclick="document.getElementById('resumeModal').style.display='none'">Cancel</button>
    </div>
</div>

<!-- MAIN GAME -->
<div id="mainGame" class="min-h-screen flex flex-col items-center">
    <header class="max-w-xl w-full text-center mb-3 mt-2 px-4 sm:px-0">
        <h1 style="font-family:'Mona Sans',sans-serif;font-weight:900;font-size:2.2rem;color:#1a1a1a;letter-spacing:-0.05em;margin-bottom:0.2rem;">Deeper-Decks<sup style="font-size:0.55em;vertical-align:super;margin-left:2px;">‚Ñ¢</sup></h1>
        <p class="text-gray-600 text-sm font-medium">The Card Game for Real Connection</p>
    </header>

    <main class="w-full max-w-6xl flex flex-col lg:flex-row gap-4 px-3 sm:px-4">

        <!-- LEFT: CONTROL PANEL -->
        <section class="lg:w-1/3 control-panel flex flex-col justify-start order-2 lg:order-1">
            <h2 style="font-family:'Mona Sans',sans-serif;font-weight:900;font-size:1.05rem;letter-spacing:-0.03em;margin-bottom:0.6rem;" id="deckTitle">Select a Deck</h2>

            <!-- STATS row -->
            <div style="display:flex;gap:0.75rem;margin-bottom:0.6rem;">
                <div style="flex:1;text-align:center;">
                    <div class="stat-mini-val" id="remainingCount" style="font-size:1.1rem;">90</div>
                    <div class="stat-mini-label" style="font-size:0.68rem;">Left</div>
                </div>
                <div style="flex:1;text-align:center;">
                    <div class="stat-mini-val" id="drawnCount" style="font-size:1.1rem;">0</div>
                    <div class="stat-mini-label" style="font-size:0.68rem;">Drawn</div>
                </div>
                <div style="flex:1;text-align:center;">
                    <div class="stat-mini-val stat-skips" id="skippedCount" style="font-size:1.1rem;">0</div>
                    <div class="stat-mini-label" style="font-size:0.68rem;">Skipped</div>
                </div>
            </div>

            <!-- HEAT METER -->
            <div id="heatMeter" style="margin-bottom:0.6rem;">
                <div class="heat-row">
                    <span class="heat-label">Heat</span>
                    <div class="heat-bar-outer"><div class="heat-bar-inner" id="heatBarFill" style="width:3%;background:#48BB78;"></div></div>
                    <span class="heat-emoji" id="heatEmoji">üå±</span>
                </div>
                <div id="heatLevelLabel" style="font-size:0.65rem;text-align:right;margin-top:1px;transition:color 0.8s ease;color:rgba(0,0,0,0.35);">Warm Up</div>
            </div>

            <!-- FILTER + HISTORY DROPDOWN -->
            <div class="deck-dropdown-wrap" id="filterDropdownWrap">
                <button class="deck-dropdown-btn" id="filterDropdownBtn" onclick="toggleFilterDropdown()">
                    <span id="filterDropdownLabel">üÉè All Cards</span>
                    <span class="dd-arrow">‚ñº</span>
                </button>
                <div class="deck-dropdown-menu" id="filterDropdownMenu">
                    <button class="dd-option active" id="ddOptAll" onclick="setCardFilter('all');closeFilterDropdown();">
                        <span class="dd-dot" style="background:#2A2A2A;"></span>
                        <span class="dd-option-label">üÉè All Cards</span>
                        <span class="dd-check">‚úì</span>
                    </button>
                    <button class="dd-option" id="ddOptQ" onclick="setCardFilter('questions');closeFilterDropdown();">
                        <span class="dd-dot" style="background:#3B82F6;"></span>
                        <span class="dd-option-label">‚ùì Questions Only</span>
                        <span class="dd-check">‚úì</span>
                    </button>
                    <button class="dd-option" id="ddOptD" onclick="setCardFilter('dares');closeFilterDropdown();">
                        <span class="dd-dot" style="background:#EF4444;"></span>
                        <span class="dd-option-label">‚ö° Dares Only</span>
                        <span class="dd-check">‚úì</span>
                    </button>
                    <button class="dd-option" id="ddOptH" onclick="openHistory();closeFilterDropdown();">
                        <span class="dd-dot" style="background:#6F38E0;"></span>
                        <span class="dd-option-label">üìñ Card History</span>
                        <span class="dd-check" style="display:none;"></span>
                    </button>
                </div>
            </div>

            <!-- TIMER -->
            <div id="timerWrap" style="margin-top:0.5rem;">
                <div class="timer-bar-outer"><div class="timer-bar-inner" id="timerBar"></div></div>
                <div class="timer-num" id="timerNum">30</div>
            </div>

            <!-- MAIN BUTTONS -->
            <button id="drawButton" class="btn-action py-3 text-base font-bold tracking-wide uppercase w-full mb-1" style="margin-top:0.6rem;">Draw Next Card</button>

            <!-- SKIP -->
            <button id="skipButton" class="w-full btn-action btn-shuffle mb-1" style="display:flex;flex-direction:column;align-items:center;gap:1px;padding:10px 20px;">
                <span>‚è≠ Skip This Card</span>
                <span class="shame-label" id="shameLabel"></span>
            </button>

            <!-- WILDCARD -->
            <div style="display:flex;gap:0.4rem;margin-bottom:0.5rem;">
                <button class="btn-wildcard" style="flex:1;" onclick="drawWildcard()">üé≤ Wildcard</button>
            </div>

            <!-- DARE VOTE -->
            <div id="dareVote">
                <div class="vote-label">üó≥ Did they actually do the dare?</div>
                <div class="vote-btns">
                    <button class="vote-btn yes" onclick="castVote('yes')">‚úÖ They did it!</button>
                    <button class="vote-btn no"  onclick="castVote('no')">‚ùå Chickened out</button>
                </div>
                <div class="vote-tally" id="voteTally"></div>
            </div>

            <!-- SHUFFLE + PAUSE -->
            <button id="shuffleButton" class="w-full btn-action btn-shuffle mt-1">üîÄ Re-Shuffle</button>
            <button onclick="pauseGame()" class="w-full btn-action btn-shuffle mt-1">‚è∏ Pause</button>
        </section>

        <!-- RIGHT: CARD AREA -->
        <section class="lg:w-2/3 flex flex-col items-center order-1 lg:order-2">

            <!-- PASS PHONE BANNER -->
            <div id="passBanner" class="w-full mb-2" style="max-width:300px;">
                <div class="pass-icon">üì±</div>
                <div class="pass-info">
                    <div class="pass-player-name" id="passPlayerName">Player 1</div>
                    <div class="pass-player-sub">Pass the phone ‚Äî it's your turn!</div>
                </div>
                <button class="btn-got-it" onclick="acknowledgeTurn()">Got it ‚úì</button>
            </div>

            <div id="cardContainer" class="relative flex-shrink-0 card-stack-container">
                <div class="card-stack-shadow"></div>
            </div>
            <div class="swipe-instruction">‚Üê swipe left to draw &nbsp;|&nbsp; swipe right to shuffle ‚Üí</div>
        </section>
    </main>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DECK DATA ‚Äî 90 cards each, with complete dares
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DECKS = {
  romantic: [
    "What's one thing about our dynamic you've never said out loud before?",
    "What small thing do I do that makes you feel genuinely seen?",
    "What moment made you think 'I actually really like this person'?",
    "What's a question you've wanted to ask me but haven't yet?",
    "What makes you feel most like yourself when you're with me?",
    "What scared you about opening up to me at first?",
    "What's your idea of a perfect night in ‚Äî describe it fully.",
    "What's something you want us to experience together that we haven't?",
    "What does feeling truly loved feel like in your body?",
    "What's a tradition you'd want to start with me?",
    "What's the last thing that made you tear up a little?",
    "How do you know when you trust someone completely?",
    "What's something you're really proud of that I don't know about?",
    "What does 'home' feel like to you ‚Äî be specific?",
    "What's a quality I have that genuinely surprised you?",
    "What's your favorite memory of us so far?",
    "What's something you've always wanted to learn or try?",
    "What makes you feel most appreciated in a relationship?",
    "Look me in the eyes right now and tell me the first thing you thought about me tonight.",
    "When do you feel most vulnerable around me ‚Äî be specific, don't generalize.",
    "Tell me about a moment you wanted to kiss me but held back.",
    "What part of yourself do you still keep protected from me?",
    "What's something you've been holding back from telling me, and why?",
    "Describe the exact moment you knew this was real for you.",
    "What's a fear you have about where we're going together?",
    "What's something you need from me that you haven't asked for yet?",
    "When do you feel most disconnected from me and what usually causes it?",
    "Tell me about a time I made you feel truly wanted.",
    "What's the hardest thing you've ever let yourself want from another person?",
    "What would you want me to do differently when you're upset?",
    "Tell me what it actually feels like in your body when I hold your hand.",
    "What's a side of yourself you only let me see?",
    "What do you think about when you can't sleep and I'm next to you?",
    "What's something that used to feel impossible that I've made feel safer?",
    "What's one thing you hope we never stop doing together?",
    "What's a goal you have and how can I actually support you in it?",
    "Tell me what you want me to do to you tonight. Say it out loud right now.",
    "Where on your body do you want me to touch you first ‚Äî right now?",
    "Describe in detail how you want to be kissed right now.",
    "Tell me what you're thinking about my body in this exact moment.",
    "What's something physical you've been craving from me?",
    "Tell me about a fantasy involving us that you've kept to yourself.",
    "What turns you on that you've never told me?",
    "Describe exactly where you want my hands when we're close.",
    "What do you want me to whisper to you when we're alone later?",
    "What's the most electric physical moment we've had together?",
    "Tell me one thing you want to try with me ‚Äî don't filter it.",
    "What do you want me to do to you with the lights off?",
    "Tell me what you look like when you completely let go.",
    "What would you do to me right now if we were completely alone?",
    "Describe the fantasy you think about when you think about us.",
    "What makes you feel most wanted ‚Äî be explicit, not vague.",
    "What's something physical you've imagined us doing that we haven't yet?",
    "Tell me what you need from me physically that I haven't given you yet.",
    "DARE: Hold my face in both hands and look at me for 30 full seconds. Don't look away.",
    "DARE: Say out loud the first physical thing you noticed about me.",
    "DARE: Put your head in my lap right now and stay there for the next two rounds.",
    "DARE: Trace a letter on my arm with your fingertip slowly. I have to guess what you wrote.",
    "DARE: Hold my hand for the next three cards without letting go once.",
    "DARE: Tell the group one thing you love about the person to your left ‚Äî make it real and specific.",
    "DARE: Give me a 30-second shoulder massage right now.",
    "DARE: Whisper something sweet in my ear that no one else can hear.",
    "DARE: Look into my eyes and tell me something you've never told anyone.",
    "DARE: Play with my hair for the next two minutes.",
    "DARE: Describe your ideal date with me in vivid detail.",
    "DARE: Give me a compliment that has nothing to do with my appearance.",
    "DARE: Whisper something you've been wanting to say to me. Then say it louder so everyone hears.",
    "DARE: Kiss my shoulder right now. Don't overthink it.",
    "DARE: Put your arms around me from behind and stay there for a full minute.",
    "DARE: Tell me exactly how you feel about me right now ‚Äî out loud, no edits.",
    "DARE: Slow dance with me for 60 seconds. No music needed. Go.",
    "DARE: Sit in my lap for the next three rounds.",
    "DARE: Trace your finger along my jawline slowly while maintaining eye contact.",
    "DARE: Tell me the thing you find most attractive about my personality.",
    "DARE: Give me a hug that lasts at least 20 seconds.",
    "DARE: Run your fingers through my hair and tell me what you're thinking.",
    "DARE: Kiss my forehead and hold it there for 10 seconds.",
    "DARE: Tell me a secret fantasy you've had about us.",
    "DARE: Kiss me wherever you want to right now. No warning, no asking.",
    "DARE: Tell everyone in this room exactly what you want to do to me later tonight.",
    "DARE: Bite my earlobe gently, then tell me out loud if you want to do it again.",
    "DARE: Pull me close and breathe on my neck for 20 seconds without saying a word.",
    "DARE: Tell me one thing you want me to do to you before this night ends.",
    "DARE: Run your hand along my leg from knee to hip. Right now. Slowly.",
    "DARE: Kiss me on the neck and don't stop until I tell you to.",
    "DARE: Describe in detail how you'd undress me if we were alone.",
    "DARE: Press your body against mine and hold that position for 30 seconds.",
    "DARE: Tell me the dirtiest thought you've had about me today.",
    "DARE: Kiss me like you mean it ‚Äî for at least 15 seconds.",
    "DARE: Whisper in my ear exactly what you want me to do to you later."
  ],

  platonic: [
    "What's the weirdest thing you genuinely believe that you rarely say out loud?",
    "What's a friendship you lost that you still think about?",
    "What's the most embarrassing thing in your camera roll right now?",
    "What's the most cringe thing your past self did that you still shudder at?",
    "What's a habit you have that would horrify your parents?",
    "What's the dumbest reason you've ever ended a friendship?",
    "What's something you do at home you'd die if anyone saw?",
    "What's your most unhinged 2 AM search history topic?",
    "What's the worst text you've sent and immediately wished you could unsend?",
    "What's the pettiest thing you've done and genuinely won't apologize for?",
    "What's a lie you've told so many times you almost believe it?",
    "What's a genuine character flaw you've just fully accepted about yourself?",
    "What's the most pathetic thing you've done for attention from someone?",
    "What's a secret skill or hobby you're embarrassed to admit you love?",
    "What's a movie or song you cry to but tell absolutely no one about?",
    "What's the most desperate thing you've ever done to seem cool?",
    "What's a red flag in yourself that you're still pretending isn't there?",
    "What's a phase you went through that you genuinely cannot explain?",
    "What's the most dishonest thing you've done that no one here knows about?",
    "What's a friendship boundary you've crossed that still bothers you?",
    "Who here would you actually call at 3 AM if something went wrong ‚Äî and be honest why?",
    "What's something you've done that would genuinely shock the people in this room?",
    "What's a grudge you're still holding that you know you should let go?",
    "What's the most selfish thing you've done disguised as an act of kindness?",
    "Tell everyone your most embarrassing moment that no one in this room knows.",
    "What's something you've said behind someone's back you'd never say to their face?",
    "What's a belief you had about yourself that turned out to be completely wrong?",
    "What's something you're secretly competitive about that would surprise people?",
    "What's a truth about yourself that's genuinely hard to say out loud?",
    "What's a moment where you disappointed yourself badly ‚Äî what happened?",
    "What's the pettiest thought you actually had today ‚Äî be honest?",
    "What's something that happened years ago you still haven't forgiven yourself for?",
    "What's a relationship, friendship or romantic, that genuinely changed who you are?",
    "What's a boundary you pretend to have but fold on every single time?",
    "What's something you're genuinely bad at that you've never admitted out loud?",
    "What's a thing you've never told your parents and probably never will?",
    "What's the most chaotic thing you've ever done while completely sober?",
    "Read the last text you sent your ex out loud. Right now. Go.",
    "Tell us the most embarrassing reason you've ever ghosted someone.",
    "Tell us about a time you lied your way out of something serious.",
    "What's the thing you've done that you're most ashamed of?",
    "What's your actual body count ‚Äî say the number out loud to the room.",
    "What would genuinely blow up your reputation if it became public right now?",
    "Who in this room are you most intimidated by and why?",
    "Tell us about a time you were genuinely cruel to someone.",
    "What's a secret you've kept from your best friend?",
    "What's the most embarrassing thing you've said or done while drunk?",
    "Tell the group something about your last relationship you've never admitted.",
    "What's something you've done you'd never want your closest friend to find out?",
    "What's a dark thought you have regularly that you know isn't rational?",
    "What's a moment where you knew you were being a terrible person but kept going?",
    "What's the most unhinged behavior you've ever done over someone you liked?",
    "What's the most embarrassing truth about your love life right now?",
    "What's the most messed up thing you've thought about someone in this room?",
    "DARE: Open your camera roll, scroll to a random photo and show the room. No skipping allowed.",
    "DARE: Show everyone your most recent DM thread ‚Äî the whole thing.",
    "DARE: Do a 60-second impression of the person to your right. Make it uncomfortably accurate.",
    "DARE: Show your screen time report. Read the top three apps out loud.",
    "DARE: Let someone go through your notes app for 45 seconds.",
    "DARE: Everyone in the room types a message to your ex and you choose which one actually gets sent.",
    "DARE: Do your best dance move for 30 seconds straight.",
    "DARE: Sing the chorus of your favorite song right now.",
    "DARE: Let someone tickle you for 15 seconds without resisting.",
    "DARE: Do 10 pushups in the middle of the room.",
    "DARE: Speak in an accent for the next three rounds.",
    "DARE: Let someone draw on your face with a pen (washable, hopefully).",
    "DARE: Call a random contact and stay on the line for 30 seconds saying absolutely nothing.",
    "DARE: Post whatever the person to your left types as your next story. No preview, no veto.",
    "DARE: Do a full dramatic performance of your worst breakup ‚Äî act both roles yourself.",
    "DARE: Let someone write any caption and post it to your Instagram right now.",
    "DARE: Read your most embarrassing saved voice memo out loud to the room.",
    "DARE: Let everyone look at your Spotify Wrapped ‚Äî all of it, no hiding.",
    "DARE: Text your mom 'I love you' with no context and show us the response.",
    "DARE: Let someone go through your photo app for 60 seconds.",
    "DARE: Do your best impression of someone famous while the group guesses who.",
    "DARE: Tell a story using only movie titles.",
    "DARE: Let the group pose you for a photo and post it immediately.",
    "DARE: Eat something weird (like hot sauce on a cracker) without complaining.",
    "DARE: The group picks one contact to text 'we need to talk.' You send it. Read the response out loud.",
    "DARE: Let someone read your last Google search out loud in the most dramatic voice they can do.",
    "DARE: Post a selfie with zero filter, zero editing, right now.",
    "DARE: Read the last five things in your clipboard out loud.",
    "DARE: Everyone picks an emoji to describe your energy tonight and explains their choice.",
    "DARE: Demonstrate ‚Äî without words ‚Äî exactly how you act when you're into someone.",
    "DARE: Let the group create a dating profile for you and you have to read it aloud.",
    "DARE: Reveal your most controversial opinion and defend it for 2 minutes.",
    "DARE: Let someone go through your search history for 30 seconds and read something aloud.",
    "DARE: Do a dramatic reading of the last text you sent to your crush/ex.",
    "DARE: Let the group vote on a new nickname for you that you have to accept for the rest of the night.",
    "DARE: Share your screen time and explain the top 3 apps."
  ],

  girlsnight: [
    "Rank everyone in this room by who you'd trust with your phone fully unlocked.",
    "What's a text you wrote, almost sent, but deleted ‚Äî describe it in full.",
    "What's the most embarrassing thing you've done to look hot for someone?",
    "Who's the situationship that still lives rent-free in your head?",
    "What's the most dramatic thing you've done post-breakup?",
    "Tell us about the worst situationship you let drag on way too long.",
    "What's the most obvious red flag you pretended wasn't there?",
    "Describe the worst date you've ever been on ‚Äî spare nothing.",
    "What's the most pathetic thing you've done to get a guy's attention?",
    "What's a lie you told a guy that you're genuinely a little proud of?",
    "What's the most embarrassing thing that's happened to you in front of a guy?",
    "What's something a girl here did that you low-key respected but would never admit?",
    "What's your most embarrassing autocorrect fail ‚Äî to a crush?",
    "What's the most unhinged Googling-an-ex moment you've had?",
    "What's the most cringe thing you've posted, immediately deleted, and hoped no one saw?",
    "What's your most shameful thirst trap moment?",
    "What's a friendship fallout you genuinely haven't gotten over?",
    "What's your most embarrassing 'read the room' fail around a guy?",
    "Be honest: which girl in this room do you think has the best dating life right now and why?",
    "What's the shadiest thing you've done to another girl over a guy?",
    "Tell the group about your messiest situationship ‚Äî what actually happened?",
    "What's your most unhinged 'is he ignoring me' spiral behavior?",
    "Who in this room do you think would crack first in a relationship ‚Äî genuinely?",
    "What's a personality trait you have that makes you a difficult girlfriend?",
    "What's a friendship red flag you have that you've never owned up to?",
    "Tell us about a time you chose a guy over a friend. Looking back ‚Äî was it worth it?",
    "What's your most toxic attachment behavior that you're still doing?",
    "What's a truth about yourself in relationships you're only just starting to admit?",
    "Tell us about a moment you knew a relationship was over but stayed anyway.",
    "What's the last guy you actually cried over ‚Äî what went wrong?",
    "What's something about yourself you're scared to bring into a relationship?",
    "What's your most embarrassing thing you've done for validation online?",
    "What's a boundary you claim to have but fold on immediately every single time?",
    "What's something you've done online that you'd be mortified if he found out about?",
    "What's the pettiest reason you've ever cut someone off?",
    "Tell us the most embarrassing thing you've done while tipsy on a night out.",
    "Tell us what happened on your wildest night out ‚Äî the real unfiltered version.",
    "What's your actual body count? Say the number. Right now. Out loud.",
    "Who in this room do you think is the best in bed based purely on vibe ‚Äî and why?",
    "What's the most explicit thing you've ever sent someone?",
    "What's a sexual preference you have that surprises people to find out?",
    "Tell us about your most physically intense encounter.",
    "Who in this room do you think is secretly going through it romantically right now?",
    "What's a sexual experience you'd never repeat ‚Äî and why?",
    "What's something you do in bed you've never told anyone about?",
    "What's the most daring place you've ever hooked up?",
    "Tell us about the time you were most attracted to someone you absolutely shouldn't have been.",
    "What's your sexual dealbreaker that's very specific and sounds kind of unhinged?",
    "Tell us one thing about your sex life your friends would actually be shocked by.",
    "What's the most jealous you've ever been and what did you do about it?",
    "What's the most confident you've felt in your body ‚Äî what caused it?",
    "Who's the one person you'd call right now if you wanted to ruin your own evening?",
    "What's the most embarrassing fantasy you've had about someone real that you know?",
    "What's the most unhinged thing you've done for a guy that you're lowkey proud of?",
    "DARE: All of you open your DMs ‚Äî the person to your left reads the first unread message out loud.",
    "DARE: Find a photo from the last 30 days in your camera roll and explain it fully to the room.",
    "DARE: Do a full runway walk across the room like you just spotted your ex and you look incredible.",
    "DARE: Everyone assigns you a Love Island persona. You have to accept it with zero argument.",
    "DARE: Make everyone rate your most recent selfie out of 10. Honestly, not kindly.",
    "DARE: Do your most embarrassing real-life flirting impression ‚Äî recreate it exactly.",
    "DARE: Show everyone your most recent purchase and explain why you bought it.",
    "DARE: Let someone do your makeup with their eyes closed.",
    "DARE: Do a 60-second TikTok dance challenge right now.",
    "DARE: Rate everyone's outfits 1-10 and explain each rating.",
    "DARE: Let someone pick out an outfit from your closet for you to wear tomorrow.",
    "DARE: Do your best celebrity impression while the group guesses who.",
    "DARE: Read the last message your ex sent you out loud with full theatrical dramatic energy.",
    "DARE: Show everyone your Spotify Daylist right now. No preview, no preparation.",
    "DARE: Text someone 'I miss you' with zero context. Read the response out loud when it comes.",
    "DARE: Post a picture chosen entirely by the person to your left on your story right now.",
    "DARE: Let someone send a voice note on your behalf to anyone in your contacts.",
    "DARE: Show the group your full camera roll from last weekend.",
    "DARE: Call your mom and tell her you're getting married (then explain it's a dare).",
    "DARE: Let the group read your last 5 texts out loud.",
    "DARE: Do a dramatic reading of your diary from middle school (if you have it).",
    "DARE: Let someone post anything they want on your social media (within reason).",
    "DARE: Reveal your celebrity crush and explain why in detail.",
    "DARE: Let the group ask your crush one question (if single) or partner one question (if taken).",
    "DARE: Post the most unflattering photo from tonight on your story. Right now.",
    "DARE: Everyone guesses your body count out loud. You then reveal the real number.",
    "DARE: Do your best impression of yourself after three drinks ‚Äî let the group rate it.",
    "DARE: Everyone describes your love life using only a reality TV show title. You respond.",
    "DARE: Post a thirst trap right now. Group decides the caption ‚Äî no veto.",
    "DARE: Let the group pick a 'red flag' emoji to add to your Instagram bio for the next 24 hours.",
    "DARE: Swipe on dating apps for 2 minutes while everyone watches and comments.",
    "DARE: Let the group create a dating profile for you and actually post it.",
    "DARE: Send a risky text to someone ‚Äî group decides the exact wording.",
    "DARE: Show your most embarrassing saved Snapchat memory.",
    "DARE: Let someone go through your WhatsApp chats for 60 seconds and read something aloud.",
    "DARE: Rate everyone's kissing ability based purely on vibes (no experience required)."
  ],

  naughty: [
    "Pick someone of the opposite gender and make out with them right now. Go.",
    "Pick someone attractive in this room and sit in their lap ‚Äî both of you have to stay there for two rounds.",
    "Choose someone and kiss them on the neck. Once. Slowly.",
    "Pick someone and let them caress your face for 30 seconds. Don't break eye contact.",
    "Choose someone and trace your finger along their collarbone. They can't move.",
    "Pick someone and make out with them for 10 seconds. The room counts out loud.",
    "Grab the hand of whoever you find most attractive here and hold it for the next three rounds.",
    "Pick someone across the room and walk over slowly. Kiss them on the cheek, then whisper something.",
    "Choose someone and let them run their fingers through your hair for 30 seconds.",
    "Pick the most attractive person here. Sit as close as physically possible to them.",
    "Choose someone and give them a slow kiss on the jaw. Take your time.",
    "Pick someone. Let them trace any letter they want anywhere on your body with their finger.",
    "Choose someone and press your forehead against theirs. Look them in the eyes. 20 seconds.",
    "Pick someone and bite their lower lip gently. Tell the room if you'd want to do it again.",
    "Choose someone and slow dance with them as close as possible. 60 seconds, no talking.",
    "Pick someone and let them kiss your hand slowly. Both of you stay still.",
    "Choose someone of the opposite gender. Make out with them until the group says stop.",
    "Pick someone. Caress their thigh slowly while making eye contact with the group.",
    "Pick someone and grind on them to imaginary music for 30 seconds. No stopping early.",
    "Choose someone and tell the room in explicit detail what you'd do to them if you were alone.",
    "Pick someone and straddle them. Stay there for the next two rounds.",
    "Choose someone and tell them exactly which position you'd want to try with them first.",
    "Pick the person you'd most want to hook up with tonight. Whisper to them what you want.",
    "Choose someone and demonstrate ‚Äî on them ‚Äî where exactly you'd want to be touched.",
    "Pick someone and tell the whole group your most explicit thought about them right now.",
    "Choose someone and caress their body from their shoulder to their hip. Slowly. Both of you stand still.",
    "Pick someone and tell them what you'd do to them the first five minutes you were alone.",
    "Choose someone and pull them close. Press your bodies together and stay there for 30 seconds.",
    "Pick someone and describe to the group in detail what you think they look like naked.",
    "Choose someone. Let them put their hands wherever they want on you for 20 seconds.",
    "Pick someone and tell them the most explicit text you'd ever send them.",
    "Choose someone of the opposite gender. Make out with them, and the rest of the group votes if you were holding back.",
    "Pick someone and tell them what you want their mouth to do to you right now.",
    "Choose someone and let them caress your neck and shoulders however they want for 30 seconds.",
    "Pick someone. Tell them what body part of theirs you've been staring at tonight.",
    "Choose someone and act out ‚Äî with your hands on them ‚Äî exactly how you'd give them a massage in bed.",
    "Pick two people and tell the room exactly how a threesome with them would go. Be specific.",
    "Choose someone and describe your most explicit fantasy about them. The whole room listens.",
    "Pick someone of the opposite gender. Make out with them for 20 full seconds. No skipping.",
    "Choose someone and tell them where on their body you want your mouth first, second, and third.",
    "Pick someone and grind against them from behind for 30 seconds. The group watches.",
    "Tell the room the filthiest thing you've ever done or want to do ‚Äî no editing.",
    "Choose someone and caress them however you want for 45 seconds ‚Äî within consent.",
    "Pick two people you'd have a threesome with and walk over, take their hands, and explain your plan.",
    "Choose someone. Let them undress one item of clothing from you ‚Äî or choose an equivalent dare.",
    "Tell the room the most explicit thing you've wanted to do since you walked in tonight.",
    "Pick someone and show them ‚Äî physically on their body ‚Äî how you'd start things off.",
    "Choose someone and press your lips to their neck and stay there for 15 seconds.",
    "Pick someone. Tell them exactly how you'd make them finish. Be specific.",
    "Tell the room who here you'd want to hook up with right now, and exactly what you'd do.",
    "Choose someone and kiss them wherever you want on their body right now.",
    "Pick someone of the opposite gender. Make out with them passionately. Group rates it 1‚Äì10.",
    "Tell the room the most explicit scenario you've imagined with anyone in this group.",
    "Choose someone and do whatever you want to them physically ‚Äî with consent ‚Äî for 30 seconds.",
    "DARE: Walk over to someone and kiss them on the cheek, then whisper exactly what you've been thinking about them.",
    "DARE: Choose someone of the opposite gender. Make out with them for 10 seconds. Group counts out loud.",
    "DARE: Pick someone. Sit in their lap and stay there for the next three rounds.",
    "DARE: Choose someone and caress their face slowly for 20 seconds. Both hold eye contact.",
    "DARE: Pick someone and give them a 30-second neck massage. The room watches the whole thing.",
    "DARE: Go up to someone and bite their earlobe. Tell them out loud if you'd want to do it again.",
    "DARE: Give someone a 20-second hug and whisper something dirty in their ear.",
    "DARE: Let someone trace their finger along your inner thigh for 10 seconds.",
    "DARE: Kiss someone on the forehead, then slowly kiss down to their lips.",
    "DARE: Let someone undo one button of your shirt.",
    "DARE: Sit back-to-back with someone for 2 minutes and describe what you're feeling.",
    "DARE: Let someone smell your neck and describe what you smell like.",
    "DARE: Pick someone of the opposite gender. Make out with them until the group says stop ‚Äî minimum 20 seconds.",
    "DARE: Choose someone and straddle them. Stay there for two full rounds.",
    "DARE: Go up to someone and run your hand along their entire body from shoulder to thigh. Slowly.",
    "DARE: Choose someone and grind on them to imaginary music for 30 seconds. Group watches.",
    "DARE: Pick someone to whisper in your ear what they want to do to you. Repeat it to the group word for word.",
    "DARE: Choose someone and press your body fully against theirs for 30 seconds. No talking.",
    "DARE: Let someone blindfold you and have someone else kiss you anywhere ‚Äî guess who it was.",
    "DARE: Give someone a hickey anywhere visible (with consent).",
    "DARE: Let someone remove one piece of your clothing (within reason).",
    "DARE: Kiss someone's neck for 30 seconds while they try not to react.",
    "DARE: Let someone tie your hands behind your back for the next round.",
    "DARE: Describe in detail what you'd do if you had 5 minutes alone with someone in this room.",
    "DARE: Pick someone and make out with them passionately for 30 seconds. Group rates you both after.",
    "DARE: Choose someone. Tell them ‚Äî and the whole room ‚Äî exactly what you'd do to them if everyone left right now.",
    "DARE: Pick someone and let them caress you however they want for 45 seconds ‚Äî within consent.",
    "DARE: Choose someone and describe your most explicit fantasy about them out loud to the whole group.",
    "DARE: Pick someone of the opposite gender. Make out with them. Then both of you describe it to the room.",
    "DARE: Tell the room the most explicit thing you've imagined doing with anyone in this group tonight.",
    "DARE: Let someone remove an article of clothing from you using only their mouth.",
    "DARE: Kiss someone in a way that would make your ex jealous.",
    "DARE: Let someone touch you anywhere they want for 20 seconds (within consent).",
    "DARE: Demonstrate your favorite position on someone (clothed, with consent).",
    "DARE: Let someone whisper the dirtiest thing they can think of in your ear.",
    "DARE: Do something to someone that makes them genuinely blush."
  ]
};

const DECK_COLORS = {romantic:'#FF1F40',platonic:'#48BB78',girlsnight:'#FF8BA4',naughty:'#6F38E0'};
const DECK_LABELS = {romantic:'Romantic Deck‚Ñ¢',platonic:'Platonic Deck‚Ñ¢',girlsnight:"Girls' Night Deck‚Ñ¢",naughty:'Naughty Deck‚Ñ¢'};
const DECK_ICONS  = {romantic:'‚ù§Ô∏è',platonic:'ü§ù',girlsnight:'üíÖ',naughty:'üî•'};
const HEAT_TIERS  = [
    {max:20, color:'#48BB78', emoji:'üå±', label:'Warm Up'},
    {max:40, color:'#FFD60A', emoji:'‚ú®', label:'Getting Interesting'},
    {max:60, color:'#FF9F0A', emoji:'üå∂', label:'Spicy'},
    {max:80, color:'#FF453A', emoji:'üî•', label:'On Fire'},
    {max:100,color:'#6F38E0', emoji:'üíÄ', label:'No Going Back'}
];
const CONSEQUENCES = [
    "Take a sip! üç∑","Tell an embarrassing truth ‚Äî no filter!","Do 10 jumping jacks right now.",
    "Text someone 'we need to talk' with no context.","Two sips! üçπ","Act out the card with someone else.",
    "Give your phone to the left for 30 seconds.","Sing the next thing you say out loud.",
    "Do your best impression of someone in this room.","Post a story chosen by the group right now."
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AUDIO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _ac = null;
function getAC(){if(!_ac)_ac=new(window.AudioContext||window.webkitAudioContext)();return _ac;}
function sfx(t){
    if(!document.getElementById('soundToggle').checked)return;
    try{
        const ctx=getAC(),o=ctx.createOscillator(),g=ctx.createGain();
        o.connect(g);g.connect(ctx.destination);
        if(t==='draw'){o.type='sine';o.frequency.setValueAtTime(440,ctx.currentTime);o.frequency.exponentialRampToValueAtTime(660,ctx.currentTime+0.1);g.gain.setValueAtTime(0.13,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.25);o.start();o.stop(ctx.currentTime+0.25);}
        else if(t==='skip'){o.type='sawtooth';o.frequency.setValueAtTime(300,ctx.currentTime);o.frequency.exponentialRampToValueAtTime(150,ctx.currentTime+0.15);g.gain.setValueAtTime(0.1,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.2);o.start();o.stop(ctx.currentTime+0.2);}
        else if(t==='dare'){o.type='triangle';o.frequency.setValueAtTime(523,ctx.currentTime);o.frequency.setValueAtTime(659,ctx.currentTime+0.1);o.frequency.setValueAtTime(784,ctx.currentTime+0.2);g.gain.setValueAtTime(0.16,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.4);o.start();o.stop(ctx.currentTime+0.4);}
        else if(t==='timer'){o.type='square';o.frequency.setValueAtTime(880,ctx.currentTime);o.frequency.setValueAtTime(440,ctx.currentTime+0.1);o.frequency.setValueAtTime(880,ctx.currentTime+0.2);g.gain.setValueAtTime(0.18,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.4);o.start();o.stop(ctx.currentTime+0.4);}
        else if(t==='shuffle'){for(let i=0;i<3;i++){const o2=ctx.createOscillator(),g2=ctx.createGain();o2.connect(g2);g2.connect(ctx.destination);o2.frequency.value=380+i*100;g2.gain.setValueAtTime(0.09,ctx.currentTime+i*0.07);g2.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+i*0.07+0.1);o2.start(ctx.currentTime+i*0.07);o2.stop(ctx.currentTime+i*0.07+0.1);}}
        else if(t==='pause'){o.type='sine';o.frequency.setValueAtTime(600,ctx.currentTime);o.frequency.exponentialRampToValueAtTime(300,ctx.currentTime+0.3);g.gain.setValueAtTime(0.14,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.35);o.start();o.stop(ctx.currentTime+0.35);}
        else if(t==='resume'){o.type='sine';o.frequency.setValueAtTime(400,ctx.currentTime);o.frequency.exponentialRampToValueAtTime(800,ctx.currentTime+0.25);g.gain.setValueAtTime(0.14,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.3);o.start();o.stop(ctx.currentTime+0.3);}
        else if(t==='vote'){o.type='sine';o.frequency.value=880;g.gain.setValueAtTime(0.1,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.15);o.start();o.stop(ctx.currentTime+0.15);}
    }catch(e){}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GAME STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let players=[],currentPlayerIdx=0,currentDeck=[],deckType='';
let cardsDrawn=0,cardsSkipped=0,cardHistory=[],sessionCode='';
let isPaused=false,timerEnabled=false,timerInterval=null,timerRemaining=30;
let isSwiping=false,swipeStartX=0,swipeStartY=0,swipeThreshold=50;
let turnAcknowledged=true,votes={};
let cardFilter='all';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FILTER DROPDOWN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleFilterDropdown(){
    const btn=document.getElementById('filterDropdownBtn');
    const menu=document.getElementById('filterDropdownMenu');
    const isOpen=menu.classList.contains('open');
    if(isOpen){closeFilterDropdown();}else{btn.classList.add('open');menu.classList.add('open');}
}
function closeFilterDropdown(){
    document.getElementById('filterDropdownBtn').classList.remove('open');
    document.getElementById('filterDropdownMenu').classList.remove('open');
}
// Close dropdown when clicking outside
document.addEventListener('click',function(e){
    const wrap=document.getElementById('filterDropdownWrap');
    if(wrap&&!wrap.contains(e.target))closeFilterDropdown();
});

function setCardFilter(f){
    cardFilter=f;
    // Update active states
    ['ddOptAll','ddOptQ','ddOptD'].forEach(id=>document.getElementById(id).classList.remove('active'));
    const labels={'all':'üÉè All Cards','questions':'‚ùì Questions Only','dares':'‚ö° Dares Only'};
    if(f==='all'){document.getElementById('ddOptAll').classList.add('active');}
    else if(f==='questions'){document.getElementById('ddOptQ').classList.add('active');}
    else if(f==='dares'){document.getElementById('ddOptD').classList.add('active');}
    document.getElementById('filterDropdownLabel').textContent=labels[f]||labels['all'];
    if(deckType){
        const qs=DECKS[deckType]||[];
        let pool=qs.map((q,i)=>({q,i,isDare:q.startsWith('DARE:')}));
        if(f==='questions')pool=pool.filter(c=>!c.isDare);
        else if(f==='dares')pool=pool.filter(c=>c.isDare);
        currentDeck=shuffleArr(pool);
        cardsDrawn=0;cardsSkipped=0;cardHistory=[];currentPlayerIdx=0;votes={};
        updateStats();renderWelcomeCard();updateHeat();renderPlayers();updateDareVote(false);stopTimer();
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SESSION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function genCode(){return Array.from({length:6},()=>'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'[Math.floor(Math.random()*33)]).join('');}
function saveSession(){
    if(!sessionCode)return;
    try{localStorage.setItem('dd_'+sessionCode,JSON.stringify({players,deckType,currentPlayerIdx,cardsDrawn,cardsSkipped,deck:currentDeck.map(c=>c.i),history:cardHistory.slice(0,30),code:sessionCode}));}catch(e){}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PLAYERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.removePlayer=function(n){players=players.filter(p=>p!==n);renderPlayers();};
let dragIdx=null;
function addPlayer(name){
    if(name&&!players.includes(name)&&players.length<10){players.push(name);renderPlayers();}
    document.getElementById('playerNameInput').value='';
}
function renderPlayers(){
    const list=document.getElementById('playersList');
    const count=document.getElementById('playerCount');
    list.innerHTML=players.length===0
        ?'<p class="text-gray-500 text-center py-4">No players added yet</p>'
        :players.map((p,i)=>`
            <div class="player-item${i===currentPlayerIdx?' current-turn':''}"
                draggable="true"
                ondragstart="dragIdx=${i}"
                ondragover="event.preventDefault();this.classList.add('drag-over')"
                ondragleave="this.classList.remove('drag-over')"
                ondrop="event.preventDefault();this.classList.remove('drag-over');dropPlayer(${i})">
                <div style="display:flex;align-items:center;gap:8px;">
                    <span style="color:rgba(255,255,255,0.25);font-size:0.9rem;">‚†ø</span>
                    ${i===currentPlayerIdx?'<span class="now-dot"></span>':''}
                    <span>${p}</span>
                    ${i===currentPlayerIdx?'<span style="font-size:0.68rem;opacity:0.5;text-transform:uppercase;letter-spacing:0.06em;">Now</span>':''}
                </div>
                <button class="btn-remove" onclick="removePlayer('${p}')">Remove</button>
            </div>`).join('');
    count.textContent=players.length;
    document.getElementById('startGameBtn').disabled=players.length<2;
}
function dropPlayer(to){if(dragIdx===null||dragIdx===to)return;const p=players.splice(dragIdx,1)[0];players.splice(to,0,p);dragIdx=null;renderPlayers();}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showModal(id){document.getElementById(id).style.display='flex';}
function hideModal(id){document.getElementById(id).style.display='none';}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DECK SELECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let selectedDeckKey='';
function selectDeck(el){
    document.querySelectorAll('.deck-option').forEach(d=>d.classList.remove('active'));
    el.classList.add('active');
    selectedDeckKey=el.dataset.deck;
    document.getElementById('confirmDeckBtn').disabled=false;
}
function shuffleArr(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

function initializeDeck(type){
    deckType=type;
    const qs=DECKS[type]||[];
    let pool=qs.map((q,i)=>({q,i,isDare:q.startsWith('DARE:')}));
    if(cardFilter==='questions')pool=pool.filter(c=>!c.isDare);
    else if(cardFilter==='dares')pool=pool.filter(c=>c.isDare);
    currentDeck=shuffleArr(pool);
    cardsDrawn=0;cardsSkipped=0;cardHistory=[];currentPlayerIdx=0;votes={};
    if(!sessionCode)sessionCode=genCode();
    document.getElementById('deckTitle').textContent=DECK_LABELS[type]||type;
    updateStats();renderWelcomeCard();updateHeat();renderPlayers();updateDareVote(false);sfx('shuffle');
    hideModal('deckModal');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CARD RENDERING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getCardColor(){return DECK_COLORS[deckType]||'#2A2A2A';}

function getCardBackHTML(){
    return `<div class="card-back flex items-center justify-center p-6 z-0">
        <div class="text-center opacity-60">
            <div style="font-size:2rem;margin-bottom:0.5rem;">${DECK_ICONS[deckType]||'üÉè'}</div>
            <p class="card-back-title">${DECK_LABELS[deckType]||''}</p>
        </div>
    </div>`;
}

function renderWelcomeCard(){
    const cc=document.getElementById('cardContainer');
    cc.querySelector('.swipe-zone')?.remove();
    const old=cc.querySelector('.card-front,.empty-card');
    const color=getCardColor();
    const html=getCardBackHTML()+`<div class="card-front flex flex-col justify-center items-center p-6 text-center z-10" style="background:${color};border:none;">
        <div style="font-size:3rem;margin-bottom:1rem;">${DECK_ICONS[deckType]||'üÉè'}</div>
        <h3 style="font-family:'Mona Sans',sans-serif;font-weight:900;font-size:1.6rem;color:white;letter-spacing:-0.04em;">${DECK_LABELS[deckType]||''}</h3>
        <p class="text-white mt-2" style="opacity:0.75;font-size:0.9rem;">${currentDeck.length} cards ¬∑ ${players.length} players</p>
        <p class="text-white mt-1" style="opacity:0.5;font-size:0.75rem;">Cards heat up as you play üå°</p>
    </div>`;
    if(old){old.classList.add('card-slide-out-right');setTimeout(()=>{old.remove();cc.insertAdjacentHTML('beforeend',html);addSwipeZone();},380);}
    else{cc.insertAdjacentHTML('beforeend',html);addSwipeZone();}
}

function makeCardHTML(card){
    const isDare=card.isDare;
    const text=isDare?card.q.substring(5).trim():card.q;
    const color=getCardColor();
    const player=players.length?players[currentPlayerIdx%players.length]:null;
    const total=(DECKS[deckType]||[]).length;
    const num=total-currentDeck.length;
    return getCardBackHTML()+`<div class="card-front flex flex-col justify-between w-full h-full text-center z-10" id="activeCard">
        <div class="flex justify-between items-center mb-2">
            <span style="font-weight:700;font-size:0.85rem;opacity:0.5;">#${num}/${total}</span>
            <div class="card-header-chip text-white" style="background-color:${color};">${isDare?'‚ö° DARE':'‚ùì QUESTION'}</div>
        </div>
        ${player?`<div class="flex justify-center mb-3"><div class="player-badge" style="background-color:${color};">üë§ ${player}</div></div>`:''}
        <div class="card-content-area flex-1 min-h-0"><p class="card-question-text">${text}</p></div>
        <div style="font-family:'Mona Sans',sans-serif;font-weight:700;font-size:0.72rem;text-align:right;color:rgba(0,0,0,0.3);margin-top:0.75rem;padding-top:0.5rem;border-top:1px solid rgba(0,0,0,0.06);">${DECK_LABELS[deckType]||''}</div>
    </div>`;
}

function showEmptyCard(){
    const cc=document.getElementById('cardContainer');
    cc.querySelector('.swipe-zone')?.remove();
    const old=cc.querySelector('.card-front,.empty-card');
    const html=getCardBackHTML()+`<div class="empty-card card-front flex flex-col justify-center items-center p-6 text-center z-10">
        <div style="font-size:3rem;margin-bottom:1rem;">üîÑ</div>
        <p style="font-family:'Mona Sans',sans-serif;font-weight:900;font-size:1.5rem;letter-spacing:-0.04em;">Deck Complete!</p>
        <p class="text-lg text-gray-600 mt-2">Shuffle for another round.</p>
    </div>`;
    if(old){old.classList.add('card-slide-out-right');setTimeout(()=>{old.remove();cc.insertAdjacentHTML('beforeend',html);addSwipeZone();},380);}
    else{cc.insertAdjacentHTML('beforeend',html);addSwipeZone();}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DRAW / SKIP / WILDCARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function drawCard(){
    if(isPaused||!deckType)return;
    if(!currentDeck.length){showEmptyCard();updateStats();return;}
    if(!turnAcknowledged&&document.getElementById('passModeToggle').checked&&cardsDrawn>0){
        const name=players[currentPlayerIdx%Math.max(players.length,1)]||'Next Player';
        document.getElementById('passPlayerName').textContent=name;
        document.getElementById('passBanner').classList.add('show');
        return;
    }
    turnAcknowledged=false;
    stopTimer();
    const card=currentDeck.pop();
    cardsDrawn++;
    cardHistory.unshift({...card,player:players[currentPlayerIdx%Math.max(players.length,1)]||'',at:Date.now()});
    if(cardHistory.length>50)cardHistory.pop();

    const cc=document.getElementById('cardContainer');
    cc.querySelector('.swipe-zone')?.remove();
    const old=cc.querySelector('.card-front,.empty-card');
    const html=makeCardHTML(card);
    const done=()=>{cc.insertAdjacentHTML('beforeend',html);addSwipeZone();updateStats();updateHeat();updateDareVote(card.isDare);sfx(card.isDare?'dare':'draw');};
    if(old){old.classList.add('card-slide-out-right');setTimeout(done,380);}else{done();}

    currentPlayerIdx=(currentPlayerIdx+1)%Math.max(players.length,1);
    renderPlayers();saveSession();
    if(timerEnabled&&document.getElementById('timerToggle').checked)startTimer();
}

function skipCard(){
    if(!deckType||!currentDeck.length)return;
    sfx('skip');cardsSkipped++;
    const card=currentDeck.pop();currentDeck.unshift(card);
    if(document.getElementById('consequenceToggle').checked)showConsequence();
    updateStats();stopTimer();
}

function drawWildcard(){
    if(!deckType)return;
    const keys=Object.keys(DECKS);
    const rk=keys[Math.floor(Math.random()*keys.length)];
    const pool=DECKS[rk];
    const q=pool[Math.floor(Math.random()*pool.length)];
    const card={q,i:-1,isDare:q.startsWith('DARE:')};
    cardsDrawn++;cardHistory.unshift({...card,player:'üé≤ Wildcard',at:Date.now()});

    const cc=document.getElementById('cardContainer');
    cc.querySelector('.swipe-zone')?.remove();
    const old=cc.querySelector('.card-front,.empty-card');
    const savedType=deckType;deckType=rk;
    const html=makeCardHTML(card);deckType=savedType;
    const done=()=>{cc.insertAdjacentHTML('beforeend',html);addSwipeZone();updateStats();updateDareVote(card.isDare);sfx('dare');};
    if(old){old.classList.add('card-slide-out-right');setTimeout(done,380);}else{done();}
}

function reshuffleDeck(){
    if(!deckType)return;
    sfx('shuffle');
    let pool=(DECKS[deckType]||[]).map((q,i)=>({q,i,isDare:q.startsWith('DARE:')}));
    if(cardFilter==='questions')pool=pool.filter(c=>!c.isDare);
    else if(cardFilter==='dares')pool=pool.filter(c=>c.isDare);
    currentDeck=shuffleArr(pool);
    cardsDrawn=0;cardsSkipped=0;cardHistory=[];currentPlayerIdx=0;votes={};
    updateStats();renderWelcomeCard();updateHeat();renderPlayers();updateDareVote(false);stopTimer();
    const cc=document.getElementById('cardContainer');
    cc.classList.add('shuffling');setTimeout(()=>cc.classList.remove('shuffling'),600);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PASS PHONE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function acknowledgeTurn(){
    document.getElementById('passBanner').classList.remove('show');
    turnAcknowledged=true;drawCard();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DARE VOTE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateDareVote(isDare){
    const dv=document.getElementById('dareVote');
    document.getElementById('voteTally').innerHTML='';votes={};
    if(isDare&&document.getElementById('dareVoteToggle').checked)dv.classList.add('show');
    else dv.classList.remove('show');
}
function castVote(val){
    votes['v'+Date.now()]=val;sfx('vote');
    const y=Object.values(votes).filter(v=>v==='yes').length;
    const n=Object.values(votes).filter(v=>v==='no').length;
    document.getElementById('voteTally').innerHTML=`<span class="tally-yes">‚úÖ ${y}</span><span class="tally-no">‚ùå ${n}</span>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HEAT METER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateHeat(){
    const total=(DECKS[deckType]||[]).length;
    const pct=total?(cardsDrawn/total)*100:0;
    let tier=HEAT_TIERS[HEAT_TIERS.length-1];
    for(const t of HEAT_TIERS){if(pct<=t.max){tier=t;break;}}
    document.getElementById('heatBarFill').style.width=Math.min(pct,100)+'%';
    document.getElementById('heatBarFill').style.background=tier.color;
    document.getElementById('heatEmoji').textContent=tier.emoji;
    document.getElementById('heatLevelLabel').textContent=tier.label;
    document.getElementById('heatLevelLabel').style.color=tier.color;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TIMER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function onTimerToggle(){
    timerEnabled=document.getElementById('timerToggle').checked;
    document.getElementById('timerDurRow').style.display=timerEnabled?'flex':'none';
    if(!timerEnabled){document.getElementById('timerWrap').classList.remove('show');stopTimer();}
}
function startTimer(){
    stopTimer();
    const dur=parseInt(document.getElementById('timerDuration').value)||30;
    timerRemaining=dur;
    document.getElementById('timerWrap').classList.add('show');
    const bar=document.getElementById('timerBar'),num=document.getElementById('timerNum');
    bar.style.transition='none';bar.style.width='100%';
    setTimeout(()=>{bar.style.transition=`width ${dur}s linear`;bar.style.width='0%';},50);
    num.textContent=dur;num.classList.remove('urgent');
    timerInterval=setInterval(()=>{
        timerRemaining--;num.textContent=timerRemaining;
        if(timerRemaining<=5){num.classList.add('urgent');sfx('timer');}
        if(timerRemaining<=0)stopTimer();
    },1000);
}
function stopTimer(){clearInterval(timerInterval);timerInterval=null;document.getElementById('timerNum').classList.remove('urgent');}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PAUSE / RESUME / END
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function pauseGame(){
    isPaused=true;sfx('pause');saveSession();
    document.getElementById('pauseCodeVal').textContent=sessionCode||'‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî';
    document.getElementById('pauseOverlay').classList.add('active');
}
function resumeGame(){isPaused=false;sfx('resume');document.getElementById('pauseOverlay').classList.remove('active');}
function endGame(){
    isPaused=false;document.getElementById('pauseOverlay').classList.remove('active');
    document.getElementById('mainGame').style.opacity='0';
    setTimeout(()=>{
        document.getElementById('mainGame').style.display='none';
        deckType='';currentDeck=[];cardsDrawn=0;cardsSkipped=0;
        cardHistory=[];sessionCode='';currentPlayerIdx=0;votes={};stopTimer();
        showModal('playerModal');
    },400);
}

function tryResume(){
    const code=document.getElementById('resumeCodeInput').value.trim().toUpperCase();
    const err=document.getElementById('resumeErr');
    if(code.length<6){err.textContent='Enter a valid 6-character code.';return;}
    let data;try{data=JSON.parse(localStorage.getItem('dd_'+code)||'null');}catch(e){}
    if(!data){err.textContent='No saved game found with that code. Check and try again.';return;}
    err.textContent='';
    players=data.players||[];deckType=data.deckType||'';
    currentPlayerIdx=data.currentPlayerIdx||0;cardsDrawn=data.cardsDrawn||0;
    cardsSkipped=data.cardsSkipped||0;cardHistory=data.history||[];sessionCode=code;
    const allQ=DECKS[deckType]||[];
    currentDeck=(data.deck||[]).map(i=>({q:allQ[i]||'',i,isDare:(allQ[i]||'').startsWith('DARE:')}));
    document.getElementById('pauseCodeVal').textContent=sessionCode;
    hideModal('resumeModal');
    const mg=document.getElementById('mainGame');mg.style.display='block';
    setTimeout(()=>{mg.style.opacity='1';document.getElementById('deckTitle').textContent=DECK_LABELS[deckType]||'';updateStats();renderWelcomeCard();updateHeat();renderPlayers();updateDareVote(false);},50);
    sfx('resume');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateStats(){
    document.getElementById('remainingCount').textContent=currentDeck.length;
    document.getElementById('drawnCount').textContent=cardsDrawn;
    document.getElementById('skippedCount').textContent=cardsSkipped;
    document.getElementById('drawButton').disabled=!currentDeck.length;
    const sl=document.getElementById('shameLabel');
    if(cardsSkipped>0){sl.style.display='block';sl.textContent=`üò¨ ${cardsSkipped} skip${cardsSkipped!==1?'s':''} ‚Äî coward energy`;}
    else sl.style.display='none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONSEQUENCE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let consecTimeout=null;
function dismissConsequence(){
    const t=document.getElementById('consecToast');
    t.classList.remove('show');
    clearTimeout(consecTimeout);consecTimeout=null;
}
function showConsequence(){
    const c=CONSEQUENCES[Math.floor(Math.random()*CONSEQUENCES.length)];
    document.getElementById('consecText').textContent=c;
    const t=document.getElementById('consecToast');
    t.classList.add('show');
    clearTimeout(consecTimeout);
    consecTimeout=setTimeout(dismissConsequence,10000);
}
(function(){
    let tsx=0;
    document.getElementById('consecToast').addEventListener('click',dismissConsequence);
    document.getElementById('consecToast').addEventListener('touchstart',e=>{tsx=e.touches[0].clientX;},{passive:true});
    document.getElementById('consecToast').addEventListener('touchend',e=>{
        if(Math.abs(e.changedTouches[0].clientX-tsx)>40)dismissConsequence();
    },{passive:true});
})();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HISTORY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openHistory(){
    const list=document.getElementById('historyList');
    if(!cardHistory.length){list.innerHTML='<p style="color:rgba(255,255,255,0.35);text-align:center;padding:2rem 0;font-size:0.85rem;">No cards drawn yet.</p>';}
    else{list.innerHTML=cardHistory.map(h=>`<div class="history-item"><div class="history-item-meta" style="color:${DECK_COLORS[deckType]||'#aaa'};">${h.player||''}${h.isDare?' ¬∑ DARE':' ¬∑ Question'}</div>${h.isDare?h.q.substring(5).trim():h.q}</div>`).join('');}
    document.getElementById('historyDrawer').classList.add('open');
    document.getElementById('historyBg').classList.add('show');
}
function closeHistory(){
    document.getElementById('historyDrawer').classList.remove('open');
    document.getElementById('historyBg').classList.remove('show');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SWIPE ‚Äî FIXED: no horizontal scroll on mobile
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addSwipeZone(){
    const cc=document.getElementById('cardContainer');
    cc.querySelector('.swipe-zone')?.remove();
    const card=cc.querySelector('.card-front');if(!card)return;
    const zone=document.createElement('div');zone.className='swipe-zone';

    let startX=0,startY=0,moving=false,isHorizontal=null;

    // Touch events ‚Äî we determine direction first, then lock
    zone.addEventListener('touchstart',e=>{
        startX=e.touches[0].clientX;
        startY=e.touches[0].clientY;
        moving=true;isHorizontal=null;
        // Don't prevent default here ‚Äî let scroll start normally
    },{passive:true});

    zone.addEventListener('touchmove',e=>{
        if(!moving)return;
        const dx=e.touches[0].clientX-startX;
        const dy=e.touches[0].clientY-startY;
        // First movement: determine direction
        if(isHorizontal===null&&(Math.abs(dx)>5||Math.abs(dy)>5)){
            isHorizontal=Math.abs(dx)>Math.abs(dy);
        }
        if(isHorizontal){
            // Only prevent default for horizontal swipes to stop page scroll
            e.preventDefault();
            card.style.transform=`translateX(${dx*0.55}px) rotate(${dx*0.045}deg)`;
        }
        // If vertical: do nothing, let browser handle scroll
    },{passive:false});

    zone.addEventListener('touchend',e=>{
        if(!moving)return;
        moving=false;
        card.style.transform='';
        if(isHorizontal){
            const dx=e.changedTouches[0].clientX-startX;
            if(Math.abs(dx)>swipeThreshold){
                if(dx<0)drawCard();
                else reshuffleDeck();
            }
        }
        isHorizontal=null;
    },{passive:true});

    // Mouse events for desktop
    zone.addEventListener('mousedown',e=>{
        isSwiping=true;swipeStartX=e.clientX;swipeStartY=e.clientY;
        e.preventDefault();
    });
    zone.addEventListener('mousemove',e=>{
        if(!isSwiping)return;
        const d=e.clientX-swipeStartX;
        if(Math.abs(d)>8)card.style.transform=`translateX(${d*.55}px) rotate(${d*.045}deg)`;
    });
    zone.addEventListener('mouseup',e=>{
        if(!isSwiping)return;
        isSwiping=false;card.style.transform='';
        const dx=e.clientX-swipeStartX;
        if(Math.abs(dx)>Math.abs(e.clientY-swipeStartY)&&Math.abs(dx)>swipeThreshold){
            if(dx<0)drawCard();else reshuffleDeck();
        }
    });
    zone.addEventListener('mouseleave',()=>{
        if(isSwiping){isSwiping=false;card.style.transform='';}
    });

    cc.appendChild(zone);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DARK MODE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function applyDarkMode(on){document.body.classList.toggle('dark-mode',on);}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SIDEBAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initSidebar(){
    const btn=document.getElementById('hamburgerButton');
    const overlay=document.getElementById('sidebarOverlay');
    const menu=document.getElementById('sidebarMenu');
    btn.style.display='flex';
    const open=()=>{menu.classList.add('active');overlay.classList.add('active');btn.classList.add('active');document.body.style.overflow='hidden';};
    const close=()=>{menu.classList.remove('active');overlay.classList.remove('active');btn.classList.remove('active');document.body.style.overflow='';};
    btn.addEventListener('click',()=>menu.classList.contains('active')?close():open());
    document.getElementById('closeSidebar').addEventListener('click',close);
    overlay.addEventListener('click',close);
    document.getElementById('sbPlayers').addEventListener('click', ()=>{close();showModal('playerModal');});
    document.getElementById('sbDeck').addEventListener('click',    ()=>{close();showModal('deckModal');});
    document.getElementById('sbHistory').addEventListener('click', ()=>{close();openHistory();});
    document.getElementById('sbResume').addEventListener('click',  ()=>{close();showModal('resumeModal');});
    document.getElementById('sbPause').addEventListener('click',   ()=>{close();pauseGame();});
    document.getElementById('sbSettings').addEventListener('click',()=>{close();showModal('settingsModal');});
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('DOMContentLoaded',()=>{
    initSidebar();

    document.getElementById('addPlayerBtn').addEventListener('click',()=>{
        const v=document.getElementById('playerNameInput').value.trim();if(v)addPlayer(v);
    });
    document.getElementById('playerNameInput').addEventListener('keypress',e=>{
        if(e.key==='Enter'){const v=e.target.value.trim();if(v)addPlayer(v);}
    });
    document.getElementById('startGameBtn').addEventListener('click',()=>{
        if(players.length>=2){hideModal('playerModal');showModal('deckModal');}
    });

    document.querySelectorAll('.deck-option').forEach(opt=>{
        opt.addEventListener('click',()=>selectDeck(opt));
    });
    document.getElementById('confirmDeckBtn').addEventListener('click',()=>{
        if(!selectedDeckKey)return;
        const mg=document.getElementById('mainGame');mg.style.display='block';
        setTimeout(()=>{mg.style.opacity='1';initializeDeck(selectedDeckKey);},50);
    });

    document.getElementById('closeSettingsBtn').addEventListener('click',()=>{
        const s=document.getElementById('swipeSensitivity').value;
        swipeThreshold=s==='low'?100:s==='high'?30:50;
        applyDarkMode(document.getElementById('themeSelect').value==='dark');
        timerEnabled=document.getElementById('timerToggle').checked;
        hideModal('settingsModal');
    });

    document.getElementById('drawButton').addEventListener('click',drawCard);
    document.getElementById('skipButton').addEventListener('click',skipCard);
    document.getElementById('shuffleButton').addEventListener('click',reshuffleDeck);

    ['settingsModal','resumeModal'].forEach(id=>{
        document.getElementById(id).addEventListener('click',e=>{if(e.target===document.getElementById(id))hideModal(id);});
    });

    addPlayer('Player 1');
    addPlayer('Player 2');

    const bar=document.getElementById('rainbowProgressBar');
    bar.getBoundingClientRect();bar.style.width='100%';
    setTimeout(()=>{
        const intro=document.getElementById('introScreen');
        intro.style.opacity='0';
        setTimeout(()=>{intro.style.display='none';showModal('playerModal');},600);
    },2300);
});
</script>
</body>
</html>
